<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     面朝大海，春暖花开
  </title>
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/css/style.css">
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">
  
<script src="/js/pace.min.js"></script>


  

  

<meta name="generator" content="Hexo 4.1.1"></head>

</html>

<body>
  <div id="app">
    <main class="content">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">面朝大海，春暖花开</a></h1>
      <h2></h2>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="#main" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>

<div id="main">
  <section class="outer">
  <article class="articles">
    
    <h1 class="page-type-title"></h1>

    
    
    <article id="post-动态规划专题之最值问题" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/03/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E4%B8%93%E9%A2%98%E4%B9%8B%E6%9C%80%E5%80%BC%E9%97%AE%E9%A2%98/"
    >动态规划专题之最值问题</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/01/03/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E4%B8%93%E9%A2%98%E4%B9%8B%E6%9C%80%E5%80%BC%E9%97%AE%E9%A2%98/" class="article-date">
  <time datetime="2020-01-03T08:28:34.000Z" itemprop="datePublished">2020-01-03</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>现有 n 块“多米诺骨牌” s1, s2, · · · , sn 水平放成一排，每块骨牌 si 包含左右两个部分，每个部分赋予一个非负整数值，如下图所示为包含 6块骨牌的序列。骨牌可做 180 度旋转，使得原来在左边的值变到右边，而原来在右边的值移到左边，假设不论 si 如何旋转， L[i] 总是存储 si 左边的值， R[i]总是存储 si 右边的值， W [i] 用于存储 si 的状态：当 L[i] ≤ R[i] 时记为 0，否则记为 1，试设计时间复杂度为 O(n) 的动态规划算法 求 ∑n i=1 −1 R[i] · L[i + 1]的最大值，以及当取得最大值时每个骨牌的状态。下面是 n = 6 时的一个例子。<br><img src="https://img-blog.csdnimg.cn/20200103101505730.png" alt="在这里插入图片描述"></p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p> <strong>step 1 确定状态</strong><br> 假设最后一块骨牌sn的状态确定，则需要在L[n]确定的情况下求</p>
<p><img src="https://img-blog.csdnimg.cn/20200103102709670.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_10,color_FFFFFF,t_70" alt="在这里插入图片描述"><strong>ps：markdown里面没法插入数学公式，我只能手写了！！！</strong><br>那么，原问题可以转化为这样的子问题(s,i)：当第i块骨牌的状态为s时候求<img src="https://img-blog.csdnimg.cn/20200103103400457.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_10,color_FFFFFF,t_70" alt="在这里插入图片描述">)用一个二维数组M[2][n]记录子问题结果，原问题最终要求max(M[0][n],M[1][n])。</p>
<p> <strong>step 2 状态转移方程</strong><br> 设第i块骨牌si的两个数为ai和bi，且ai ≤ bi，则<br> <img src="https://img-blog.csdnimg.cn/20200103104450125.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_10,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <strong>step 3 初始状态</strong><br>初始条件： 显然，M[0][1] = M[1][1]  = 0</p>
<p> <strong>step 4 计算顺序</strong></p>
<p>因为后面的计算需要用到前面的结果，所以循环从前往后遍历。</p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><ul>
<li>C语言实现</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 6</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dynaminprogramming</span><span class="params">(<span class="keyword">int</span> L[],<span class="keyword">int</span> R[],<span class="keyword">int</span> w[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">int</span> m[<span class="number">2</span>][N+<span class="number">1</span>] = &#123;<span class="number">0</span>&#125;;<span class="comment">//初始化</span></span><br><span class="line">   <span class="keyword">int</span> p[<span class="number">2</span>][N+<span class="number">1</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">   <span class="keyword">int</span> a,b,c,d,<span class="built_in">max</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*保证 a &lt;= b  c &lt;= d*/</span></span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; N; i++)</span><br><span class="line">   &#123;</span><br><span class="line">       <span class="keyword">if</span>(w[i] == <span class="number">0</span>) <span class="comment">//Si</span></span><br><span class="line">            a = L[i],b = R[i];</span><br><span class="line">       <span class="keyword">else</span></span><br><span class="line">            a = R[i],b = L[i];</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span>(w[i+<span class="number">1</span>] == <span class="number">0</span>) <span class="comment">// Si+1</span></span><br><span class="line">            c = L[i+<span class="number">1</span>],d = R[i+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            c = R[i+<span class="number">1</span>],d = L[i+<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span>((m[<span class="number">0</span>][i] + b*c) &gt; (m[<span class="number">1</span>][i] + a*c))</span><br><span class="line">       &#123;</span><br><span class="line">           m[<span class="number">0</span>][i+<span class="number">1</span>] += m[<span class="number">0</span>][i] + b*c;</span><br><span class="line">           p[<span class="number">0</span>][i+<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">else</span></span><br><span class="line">       &#123;</span><br><span class="line">           m[<span class="number">0</span>][i+<span class="number">1</span>] += m[<span class="number">1</span>][i] + a*c;</span><br><span class="line">           p[<span class="number">0</span>][i+<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span>((m[<span class="number">0</span>][i] + b*d) &gt; (m[<span class="number">1</span>][i] + a*d))</span><br><span class="line">       &#123;</span><br><span class="line">           m[<span class="number">1</span>][i+<span class="number">1</span>] += m[<span class="number">0</span>][i] + b*d;</span><br><span class="line">           p[<span class="number">1</span>][i+<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">else</span></span><br><span class="line">       &#123;</span><br><span class="line">           m[<span class="number">1</span>][i+<span class="number">1</span>] += m[<span class="number">1</span>][i] + a*d;</span><br><span class="line">           p[<span class="number">1</span>][i+<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(m[<span class="number">0</span>][N] &gt; m[<span class="number">1</span>][N])</span><br><span class="line">   &#123;</span><br><span class="line">        w[N] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">max</span> = m[<span class="number">0</span>][N];</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">   &#123;</span><br><span class="line">        w[N] = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">max</span> = m[<span class="number">1</span>][N];</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i = N;i &gt; <span class="number">1</span>; i--)</span><br><span class="line">   &#123;</span><br><span class="line">       w[i<span class="number">-1</span>] = ((w[i] == <span class="number">0</span>) ? (p[<span class="number">0</span>][i]) : (p[<span class="number">1</span>][i]));<span class="comment">//确定最终状态</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="built_in">max</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> l[N+<span class="number">1</span>] = &#123;<span class="number">0</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">11</span>&#125;;<span class="comment">//测试数据</span></span><br><span class="line">    <span class="keyword">int</span> r[N+<span class="number">1</span>] = &#123;<span class="number">0</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">10</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> w[N+<span class="number">1</span>] = &#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;;<span class="comment">//初始状态</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">max</span> = dynaminprogramming(l,r,w);<span class="comment">//计算最大值</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,<span class="built_in">max</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++)<span class="comment">//每块骨牌的状态</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\t"</span>,w[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Python实现</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dynamic_programming</span><span class="params">(L,R,W)</span>:</span></span><br><span class="line">    n = len(L) - <span class="number">1</span> <span class="comment"># 骨牌数量</span></span><br><span class="line">    </span><br><span class="line">    m = [[<span class="number">0</span>] * len(L) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>)] <span class="comment"># 创建二维数组</span></span><br><span class="line">    p = [[<span class="number">0</span>] * len(L) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>)]</span><br><span class="line">    </span><br><span class="line">    a = <span class="number">0</span></span><br><span class="line">    b = <span class="number">0</span></span><br><span class="line">    c = <span class="number">0</span></span><br><span class="line">    d = <span class="number">0</span></span><br><span class="line">    max_sum = <span class="number">0</span></span><br><span class="line">    <span class="comment"># 确保a &lt;= b且c &lt;= d</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,n):</span><br><span class="line">        a,b = (L[i],R[i]) <span class="keyword">if</span>(w[i] == <span class="number">0</span>) <span class="keyword">else</span> (R[i],L[i])</span><br><span class="line">        c,d = (L[i+<span class="number">1</span>],R[i+<span class="number">1</span>]) <span class="keyword">if</span>(w[i+<span class="number">1</span>] == <span class="number">0</span>) <span class="keyword">else</span> (R[i+<span class="number">1</span>],L[i+<span class="number">1</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>((m[<span class="number">0</span>][i] + b*c) &gt; (m[<span class="number">1</span>][i]) + a*c):</span><br><span class="line">            m[<span class="number">0</span>][i+<span class="number">1</span>] = m[<span class="number">0</span>][i] + b*c</span><br><span class="line">            p[<span class="number">0</span>][i+<span class="number">1</span>] = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            m[<span class="number">0</span>][i+<span class="number">1</span>] = m[<span class="number">1</span>][i] + a*c</span><br><span class="line">            p[<span class="number">0</span>][i+<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>((m[<span class="number">0</span>][i] + b*d) &gt; (m[<span class="number">1</span>][i] + a*d)):</span><br><span class="line">            m[<span class="number">1</span>][i+<span class="number">1</span>] = m[<span class="number">0</span>][i] + b*d</span><br><span class="line">            p[<span class="number">1</span>][i+<span class="number">1</span>] = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            m[<span class="number">1</span>][i+<span class="number">1</span>] = m[<span class="number">1</span>][i] + a*d</span><br><span class="line">            p[<span class="number">1</span>][i+<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">     <span class="comment"># 确定最大值       </span></span><br><span class="line">    W[n],max_sum = (<span class="number">0</span>,m[<span class="number">0</span>][n]) <span class="keyword">if</span>(m[<span class="number">0</span>][n] &gt; m[<span class="number">1</span>][n]) <span class="keyword">else</span> (<span class="number">1</span>,m[<span class="number">1</span>][n])</span><br><span class="line">    <span class="comment"># 确定每块骨牌最终状态    </span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n,<span class="number">1</span>,<span class="number">-1</span>):</span><br><span class="line">        W[i<span class="number">-1</span>] = p[<span class="number">0</span>][i] <span class="keyword">if</span>(W[i] == <span class="number">0</span>) <span class="keyword">else</span> p[<span class="number">1</span>][i]</span><br><span class="line">    <span class="comment">#print(m)      </span></span><br><span class="line">    <span class="keyword">return</span> max_sum</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    l = [<span class="number">0</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">11</span>] <span class="comment"># 测试数据</span></span><br><span class="line">    r = [<span class="number">0</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">10</span>]</span><br><span class="line">    w = [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>] <span class="comment"># 骨牌的最初状态</span></span><br><span class="line">    max_sum = dynamic_programming(l,r,w)</span><br><span class="line">    print(max_sum)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,len(w)):</span><br><span class="line">        print(w[i])</span><br></pre></td></tr></table></figure>

<ul>
<li>Java实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Excerise6</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getMaxSum</span><span class="params">(<span class="keyword">int</span>[] L,<span class="keyword">int</span>[] R,<span class="keyword">int</span>[] W)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = L.length -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> m[][] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>][n+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">int</span> p[][] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>][n+<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> a,b,c,d,max = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//给a,b,c,d赋值 确保a &lt;= b and c &lt;= d</span></span><br><span class="line">            <span class="keyword">if</span>(W[i] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                a = L[i];</span><br><span class="line">                b = R[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                a = R[i];</span><br><span class="line">                b = L[i];</span><br><span class="line">            &#125;</span><br><span class="line">           <span class="keyword">if</span>(W[i+<span class="number">1</span>] == <span class="number">0</span>)</span><br><span class="line">           &#123;</span><br><span class="line">               c = L[i+<span class="number">1</span>];</span><br><span class="line">               d = R[i+<span class="number">1</span>];</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">else</span></span><br><span class="line">           &#123;</span><br><span class="line">               c = R[i+<span class="number">1</span>];</span><br><span class="line">               d = L[i+<span class="number">1</span>];</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//算法核心部分</span></span><br><span class="line">            <span class="keyword">if</span>((m[<span class="number">0</span>][i] + b*c) &gt; (m[<span class="number">1</span>][i] + a*c))</span><br><span class="line">            &#123;</span><br><span class="line">                m[<span class="number">0</span>][i+<span class="number">1</span>] += m[<span class="number">0</span>][i] + b*c;</span><br><span class="line">                p[<span class="number">0</span>][i+<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                m[<span class="number">0</span>][i+<span class="number">1</span>] += m[<span class="number">1</span>][i] + a*c;</span><br><span class="line">                p[<span class="number">0</span>][i+<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>((m[<span class="number">0</span>][i] + b*d) &gt; (m[<span class="number">1</span>][i] + a*d))</span><br><span class="line">            &#123;</span><br><span class="line">                m[<span class="number">1</span>][i+<span class="number">1</span>] += m[<span class="number">0</span>][i] + b*d;</span><br><span class="line">                p[<span class="number">1</span>][i+<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                m[<span class="number">1</span>][i+<span class="number">1</span>] += m[<span class="number">1</span>][i] + a*d;</span><br><span class="line">                p[<span class="number">1</span>][i+<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//计算最值</span></span><br><span class="line">        <span class="keyword">if</span>(m[<span class="number">0</span>][n] &gt; m[<span class="number">1</span>][n])</span><br><span class="line">        &#123;</span><br><span class="line">            W[n] = <span class="number">0</span>;</span><br><span class="line">            max = m[<span class="number">0</span>][n];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            W[n] = <span class="number">1</span>;</span><br><span class="line">            max = m[<span class="number">1</span>][n];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//确定每块骨牌最终状态</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = n;i &gt; <span class="number">1</span>; i--)</span><br><span class="line">        &#123;</span><br><span class="line">            W[i-<span class="number">1</span>] = ((W[i] == <span class="number">0</span>) ? (p[<span class="number">0</span>][i]) : (p[<span class="number">1</span>][i]));<span class="comment">//确定最终状态</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">/* 测试数据*/</span></span><br><span class="line">        <span class="keyword">int</span> l[] = &#123;<span class="number">0</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">11</span>&#125;;</span><br><span class="line">        <span class="keyword">int</span> r[] = &#123;<span class="number">0</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">10</span>&#125;;</span><br><span class="line">        <span class="keyword">int</span> w[] = &#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;;<span class="comment">// 骨牌最初状态</span></span><br><span class="line">        <span class="keyword">int</span> max = getMaxSum(l,r,w);</span><br><span class="line">        System.out.println(max);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= l.length-<span class="number">1</span>; i++)<span class="comment">//每块骨牌的状态</span></span><br><span class="line">            System.out.print(w[i] + <span class="string">"\t"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/01/03/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E4%B8%93%E9%A2%98%E4%B9%8B%E6%9C%80%E5%80%BC%E9%97%AE%E9%A2%98/" data-id="ck4xwd5ft00009gvi72oi4i7k"
        class="article-share-link">分享</a>
      
    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-贪心算法之邮局位置问题" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/02/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95%E4%B9%8B%E9%82%AE%E5%B1%80%E4%BD%8D%E7%BD%AE%E9%97%AE%E9%A2%98/"
    >贪心算法之邮局位置问题</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/01/02/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95%E4%B9%8B%E9%82%AE%E5%B1%80%E4%BD%8D%E7%BD%AE%E9%97%AE%E9%A2%98/" class="article-date">
  <time datetime="2020-01-02T09:12:41.000Z" itemprop="datePublished">2020-01-02</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>在一条街上有 n 所房子， H[i] (1 ≤ i ≤ n) 是第 i 所房子离街道起点处的距离 (以米为单位)，假定 H[1] &lt; H[2] &lt; · · · &lt; H[n]。目前该街道上还没有一所邮局，现计划新建若干所邮局，使得每所房子到最近的邮局距离在 100 米以内。试设计一个时间复杂度为 O(n) 的算法，计算出新建邮局的位置，即每所新建邮局离街道起点处的距离 P [j] (1 ≤ j ≤ m)，同时确保新建邮局个数 m 最小。</p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>为了使邮局数量m最小，也就是说我们要让邮局的存在效用最大化，即每个邮局的覆盖范围最大话，如何做才能让单个邮局覆盖范围最大呢？当然是把邮局建在两栋房子之间。下面用一个图来说明（画得有点挫，见谅！！！）：<br><img src="https://img-blog.csdnimg.cn/2020010215460952.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">从图里面可以看出，Post[1]设立在H[1]+100处时覆盖范围最广（Post[i]表示第i所邮局，1 ≤ i ≤ n），在此点的右边设立，不符合题意，第一户人家距离邮局太远，若在左边，那么范围不够大，导致邮局数量变多，也不符合贪心策略思想。将第一个邮局设立之后，应当考虑Post[2],Post[3]…。假如H[2]到Post[1]的距离在100m以内（包括100m），那么Post[1]可以覆盖H[1]和H[2]，现在只需要考虑为H[3]以后的房子建邮局，即在H[3]+100处新建邮局；反之，如果H[2]到Post[1]的距离在100m之外，那么，Post[1]的覆盖范围只是H[1]，我们需要为H[2]及其后的房子新建邮局，即在H[2]+100处新建。后面依次类推。<br>将上述分析一般化。<br>Post[i]为在H[i]+100处新建的邮局，如果H[i+1] - Post[i] ≤ 100 ，那么，下一个邮局在H[i+2]+100处新建；如果H[i+1] - Post[i] &gt;100，那么，下一个邮局在H[i+1]+100处新建。据此，可以写出下面的算法。</p>
<p> <strong>- Note：将起点start当做H[0]和Post[0]</strong></p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><ul>
<li>C语言实现 </li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BASE 100 <span class="comment">//每所房子到最近的邮局距离</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 4 <span class="comment">//房子数量</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">greedy_algorithm</span><span class="params">(<span class="keyword">int</span> h[],<span class="keyword">int</span> post[],<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(i &lt;= n)</span><br><span class="line">    &#123;</span><br><span class="line">        post[++num] = h[i] + BASE;</span><br><span class="line">        <span class="keyword">if</span>(h[i+<span class="number">1</span>] - post[num] &lt;= BASE)</span><br><span class="line">            i += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            i += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> num;<span class="comment">//最少邮局数量</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> house[N+<span class="number">1</span>] = &#123;<span class="number">0</span>,<span class="number">50</span>,<span class="number">180</span>,<span class="number">260</span>,<span class="number">350</span>&#125;;<span class="comment">//测试数据</span></span><br><span class="line">    <span class="keyword">int</span> post[N+<span class="number">1</span>] = &#123;<span class="number">0</span>&#125;;<span class="comment">//初始化</span></span><br><span class="line">    <span class="keyword">int</span> m = greedy_algorithm(house,post,N);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++)<span class="comment">//每个邮局距离start的距离</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\t"</span>,post[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n邮局个数为：%d\n"</span>,m);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Python实现</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">BASE = <span class="number">100</span> <span class="comment"># 每所房子到最近的邮局距离</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greedy</span><span class="params">(house)</span>:</span></span><br><span class="line">    n = len(house)</span><br><span class="line">    post = [<span class="number">0</span>]</span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(i &lt; n):</span><br><span class="line">        post.append(house[i] + BASE)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(house[i+<span class="number">1</span>] - post[<span class="number">-1</span>] &lt;= BASE):</span><br><span class="line">            i += <span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> post</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">"__main__"</span>:</span><br><span class="line">    house = [<span class="number">0</span>,<span class="number">50</span>,<span class="number">180</span>,<span class="number">260</span>,<span class="number">350</span>] <span class="comment"># 测试数据</span></span><br><span class="line">    post = []</span><br><span class="line">    post = greedy(house)</span><br><span class="line">    </span><br><span class="line">    m = len(post) <span class="number">-1</span><span class="comment"># 邮局个数</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m+<span class="number">1</span>):</span><br><span class="line">        print(post[i])<span class="comment"># 邮局i到start的距离</span></span><br><span class="line">    print(m)</span><br></pre></td></tr></table></figure>

<ul>
<li>Java实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PostLength</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">greedyAlgorithm</span><span class="params">(<span class="keyword">int</span>[] hose, <span class="keyword">int</span>[] post)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> base = <span class="number">100</span>;<span class="comment">//每所房子到最近的邮局距离</span></span><br><span class="line">        <span class="keyword">int</span> n = hose.length;</span><br><span class="line">        <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; n)</span><br><span class="line">        &#123;</span><br><span class="line">            post[++num] = hose[i] + base;</span><br><span class="line">            <span class="keyword">if</span>(hose[i+<span class="number">1</span>] - post[num] &lt;= base)</span><br><span class="line">                i += <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                i += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> num;<span class="comment">//返回邮局数量</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] house = &#123;<span class="number">0</span>,<span class="number">50</span>,<span class="number">180</span>,<span class="number">260</span>,<span class="number">350</span>&#125;;<span class="comment">//测试数据</span></span><br><span class="line">        <span class="keyword">int</span>[] post = &#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;<span class="comment">//初始化</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> m = greedyAlgorithm(house,post);<span class="comment">//最小邮局数</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=m ; i++)</span><br><span class="line">            System.out.println(post[i]);<span class="comment">//每个邮局离start的距离</span></span><br><span class="line">        System.out.println(m);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/01/02/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95%E4%B9%8B%E9%82%AE%E5%B1%80%E4%BD%8D%E7%BD%AE%E9%97%AE%E9%A2%98/" data-id="ck4wiimrv0000f8vidguzc8pz"
        class="article-share-link">分享</a>
      
    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-动态规划专题---计数型" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/27/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E4%B8%93%E9%A2%98---%E8%AE%A1%E6%95%B0%E5%9E%8B/"
    >动态规划专题---计数型</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/12/27/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E4%B8%93%E9%A2%98---%E8%AE%A1%E6%95%B0%E5%9E%8B/" class="article-date">
  <time datetime="2019-12-27T12:15:53.000Z" itemprop="datePublished">2019-12-27</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p> 有一个机器人位于一个 m × n 个网格左上角。机器人每一时刻只能向下或者向右移动一步。机器人试图达到网格的右下角。问有多少条不同的路径？如图所示。（n和m均不超过100）<br> <img src="https://img-blog.csdnimg.cn/20191227170418210.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_10,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><ul>
<li><strong>step1：确定状态</strong><br>机器人最后一步无论用何种方式到达右下角，总有最后挪动的一步：向右或者向下<br><img src="https://img-blog.csdnimg.cn/20191227172013140.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_10,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>右下角坐标设定为(m-1,n-1)。那么，前一步机器人一定在(m-2,n-1)或者(m-1,n-2)。如果机器人有X种方式从左上角走到(m-2,n-1)；有Y种方式从右上角走到(m-1,n-2)，那么机器人共有X+Y+2种方式走到(m-1,n-1)处。经过上面的分析，原问题转化为：机器人有多少种方式从左上角走到(m-2,n-1)和(m-1,n-2)，这是原问题的子问题。为什么是子问题呢，因为问题规模比原问题小了，为什么呢？求机器人有多少种方式从左上角走到(m-2,n-1)和(m-1,n-2)，那么原网格最后一行或最后一列可以直接划掉。</li>
<li><strong>step 2：状态转移方程</strong><br>设f[i][j]为机器人有多少种方式从左上角走到(i,j)，对于任意一个格子(i,j)有<br>f[i][j] = f[i-1][j] + f[i][j-1]<br>其中，f[i][j] 表示机器人有多少种方式走到(i,j)；f[i-1][j]表示机器人有多少种方式走到(i-1,j)；f[i][j-1] 表示机器人有多少种方式走到(i,j-1)。</li>
<li><strong>step 3：初始条件和边界情况</strong><br>初始条件：f[0][0] = 1，因为机器人只有一种方式到左上角<br>边界情况：当i = 0 或j = 0 时，则前一步只能有一个方向过来：要么向右，要么向下，则f[0][j] = f[i][0] = 1<br><img src="https://img-blog.csdnimg.cn/20191227174635873.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_10,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
<li><strong>step 4：计算顺序</strong><br>f[0][0] = 1<br>计算第0行:f[0][0], f[0][1],…,f[0][n-1]<br>计算第1行:f[1][0], f[1][1],…,f[1][n-1]<br>…<br>计算第m-1行:f[m-1][0], f[m-1][1],…,f[m-1][n-1]<br>那么，最终结果就存储在f[m-1][n-1]中。时间复杂度（计算步数）：O(mn)，空间复杂度（数组大小）：O(mn)。<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2></li>
<li>C语言实现</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> M 3</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 3</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> net[M][N] = &#123;<span class="number">0</span>&#125;;<span class="comment">//初始化</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; M; i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;j &lt; N ; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(i == <span class="number">0</span> || j == <span class="number">0</span>) <span class="comment">//到达第一行或第一列只有一种走法</span></span><br><span class="line">                net[i][j]  = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                net[i][j] = net[i<span class="number">-1</span>][j] + net[i][j<span class="number">-1</span>]; <span class="comment">//到(i,j)的方式 = 到(i-1,j) + (i,j-1)的方式</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,net[M<span class="number">-1</span>][N<span class="number">-1</span>]);<span class="comment">//输出最终结果</span></span><br><span class="line">    <span class="comment">//return net[M-1][N-1];</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Java实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Count</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">dynamicProgramming</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> net[][] = <span class="keyword">new</span> <span class="keyword">int</span>[m][n];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(i == <span class="number">0</span> || j == <span class="number">0</span>)</span><br><span class="line">                    net[i][j] = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    net[i][j] = net[i-<span class="number">1</span>][j] + net[i][j-<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> net[m-<span class="number">1</span>][n-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Scanner input = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">0</span>,n = <span class="number">0</span>;</span><br><span class="line">        m = input.nextInt();</span><br><span class="line">        n = input.nextInt();</span><br><span class="line">        <span class="comment">//System.out.println(m+ " " + n);</span></span><br><span class="line">        <span class="keyword">int</span> result = dynamicProgramming(m,n);</span><br><span class="line">        System.out.println(result);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Python实现</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dynamic_programming_count</span><span class="params">(m,n)</span>:</span></span><br><span class="line">    net = [[<span class="number">0</span>]*n <span class="keyword">for</span> i <span class="keyword">in</span> range(m)] <span class="comment"># define  two-dimensional array </span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">if</span>(i == <span class="number">0</span> <span class="keyword">or</span> j == <span class="number">0</span>):</span><br><span class="line">                net[i][j] = <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                net[i][j] = net[i<span class="number">-1</span>][j] + net[i][j<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> net[m<span class="number">-1</span>][n<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    m = int(input(<span class="string">"please input m:"</span>))</span><br><span class="line">    n = int(input(<span class="string">"please input n:"</span>))</span><br><span class="line">    num = dynamic_programming_count(m,n)</span><br><span class="line">    print(num)</span><br></pre></td></tr></table></figure>


      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/27/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E4%B8%93%E9%A2%98---%E8%AE%A1%E6%95%B0%E5%9E%8B/" data-id="ck4o4ey700000p8vidrl07i8z"
        class="article-share-link">分享</a>
      
    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Hadoop之倒排索引" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/25/Hadoop%E4%B9%8B%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95/"
    >Hadoop之倒排索引</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/12/25/Hadoop%E4%B9%8B%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95/" class="article-date">
  <time datetime="2019-12-25T12:25:02.000Z" itemprop="datePublished">2019-12-25</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>输入N个文件，生成带详细信息的倒排索引。其中，输入为莎士比亚文集<a href="http://course.ucas.ac.cn/access/content/group/49762-2/Shakespeare.tar.gz" target="_blank" rel="noopener">Shakespeare.tar.gz</a>。<br>举例如下，有4个输入文件：</p>
<ul>
<li>d1.txt: cat dog cat fox</li>
<li>d2.txt: cat bear cat cat fox</li>
<li>d3.txt: fox wolf dog</li>
<li>d4.txt: wolf hen rabbit cat sheep<br>要求建立如下格式的倒排索引：</li>
<li>cat —&gt;3: {(d1.txt,2,4),(d2.txt,3,5),(d4.txt,1,5)}</li>
<li>单词—&gt;出现该单词的文件个数: {(出现该单词的文件名（或文件id)，单词在该文件中的出现次数，该文件 的总单词数),……}</li>
</ul>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul>
<li><p>硬件环境：Intel(R) Core(TM)i5-8250U <a href="mailto:CPU@1.6GHz">CPU@1.6GHz</a> 1.8GHz / 8GB内存</p>
</li>
<li><p>软件环境：Ubuntu18.04 64-bit  Java 13.0.1 Hadoop 2.7.4</p>
<h2 id="倒排索引"><a href="#倒排索引" class="headerlink" title="倒排索引"></a>倒排索引</h2><p>倒排索引是文档检索系统中最常用的数据结构，被广泛用于全文搜索引擎。它主要是用来存储某个单词（或词组）在一个文档或一组文档的存储位置的映射，即提供了一种根据内容来查找文档的方式。由于不是根据文档来确定文档所包含的内容，而是进行了相反的操作（根据关键字来查找文档），因而称为倒排索引（Inverted Index）。通常情况下，倒排索引由一个单词（词组）以及相关的文档列表（标示文档的ID号，或者是指定文档所在位置的URI）组成，如下图所示：<br><img src="https://img-blog.csdnimg.cn/20191225192348832.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>从上图可以看出，单词1出现在{文档1、文档4、文档13、……}中，单词2出现在{文档3、文档5、文档15、…..}中，而单词3出现在{文档1、文档8、文档20、….}中，还需要给每个文档添加一个权值，用来指出每个文档与搜素内容相关的相关度，如下图所示：<br><img src="https://img-blog.csdnimg.cn/20191225192511863.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>最常用的是使用词频作为权重，即记录单词在文档中出现的次数了。以英文为例，如下图所示，索引文件中的“MapReduce”一行表示：“MapReduce”这个单词在文本T0中出现过1次，T1中出现过1次，T2中出现过2次。当搜索条件为“MapReduce”、“is”、“simple”时，对应的集合为：{T0，T1，T2}∩{ T0，T1}∩{ T0，T1}={ T0，T1}，即文本T0和T1包含所要索引的单词，而且只有T0是连续的。<br><img src="https://img-blog.csdnimg.cn/20191225192837964.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="总体思路"><a href="#总体思路" class="headerlink" title="总体思路"></a>总体思路</h2><p>通过两个 Map/Reduce 过程就可以到达要求。 第一个Map/Reduce 统计各个文件中的所有单词的出现次数，以及各个文件单词总数；第二个 Map/Reduce 根据第一个 Map/Reduce 的统计结果处理加工得到单词倒排索引。</p>
</li>
<li><p>第一个 map/reduce 详细设计<br>在 map 过程中，重写 map 类， 利用 StringTokenizer 类，将 map 方法中的<br>value 值中存储的文本，拆分成一个个的单词， 并获取文件名， 以两种格式进<br>行输出&lt;filename+word,1&gt;或者&lt;filename,1&gt;</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(Object key, Text value, Context context)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IOException, InterruptedException </span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">//获取文件名</span></span><br><span class="line">            FileSplit fileSplit= (FileSplit)context.getInputSplit();</span><br><span class="line">            String fileName = fileSplit.getPath().getName();</span><br><span class="line">    </span><br><span class="line">            <span class="comment">//获取单词在单个文件中出现次数，及文件单词总数</span></span><br><span class="line">            StringTokenizer itr= <span class="keyword">new</span> StringTokenizer(value.toString());</span><br><span class="line">            <span class="keyword">for</span>(; itr.hasMoreTokens(); ) </span><br><span class="line">            &#123;</span><br><span class="line">                String word =removeNonLetters( itr.nextToken().toLowerCase());</span><br><span class="line">                String fileWord = fileName+<span class="string">"\001"</span>+word;</span><br><span class="line">                <span class="keyword">if</span>(!word.equals(<span class="string">""</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    context.write(<span class="keyword">new</span> Text(fileWord), <span class="keyword">new</span> IntWritable(<span class="number">1</span>));</span><br><span class="line">                    context.write(<span class="keyword">new</span> Text(fileName), <span class="keyword">new</span> IntWritable(<span class="number">1</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>在Reduce过程中，统计得到每个文件中每个单词的出现次数，以及每个文件的单词总数，输出&lt;key,count&gt;。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (IntWritable val : values)</span><br><span class="line">    &#123;</span><br><span class="line">        sum += val.get();</span><br><span class="line">    &#125;</span><br><span class="line">    context.write(key,<span class="keyword">new</span> IntWritable(sum));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>第二个 map/reduce 详细设计<br>Map过程读取第一个MR的输出，对value值进行拆分，重新组合后输出键为固定Text类型值index，值为filename+word+count或者filename+count。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(Object key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    String valStr = value.toString();</span><br><span class="line">    String[] records = valStr.split(<span class="string">"\t"</span>);</span><br><span class="line">    context.write(<span class="keyword">new</span> Text(<span class="string">"index"</span>),<span class="keyword">new</span> Text(records[<span class="number">0</span>]+<span class="string">"\001"</span>+records[<span class="number">1</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Reduce过程中定义四个HashMap，Map&lt;String,Integer&gt; wordinfilescount，key为单词+文件名，value为单词在该文件中出现的次数；Map&lt;String,Integer&gt; filescount ，key为文件名，value为文件的单词总数；Map&lt;String,Integer&gt; wordinfiles， key为单词，value为单词在多少个文件中现；Map&lt;String,String&gt; indexes，key为单词，value为倒排索引。读取values值，根据设定分隔符拆分，判断拆分后长度如果为2，则该值为文件名+文件单词总数，将拆分后的文件名及文件单词总数，组成键值对放入Map&lt;String,Integer&gt; filescount；拆分后长度如果为3，则该值为文件名+单词+单词在该文件中出现次数，将拆分后的文件名+单词及单词在该文件中出现次数组成键值对放入Map&lt;String,Integer&gt; wordinfilescount，同时统计单词在多少个文件中出现，并组成键值对放入Map&lt;String,Integer&gt; wordinfiles。遍历Map&lt;String,Integer&gt; wordinfilescount，将单词作为键，“单词-&gt;出现该单词的文件个数:总文件个数：{(出现该单词的文件名，单词在该文件中的出现次数，该文件的总单词数)”作为值，放入Map&lt;String,String&gt; indexes中。遍历Map&lt;String,String&gt; indexes获取倒排索引并输出全部索引。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span>  <span class="title">InverseReducer</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">NullWritable</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Integer&gt; wordinfilescount = <span class="keyword">new</span> HashMap&lt;String, Integer&gt;();<span class="comment">//key为单词+文件名，value为单词在该文件中出现的次数</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Integer&gt; filescount = <span class="keyword">new</span> HashMap&lt;String, Integer&gt;();<span class="comment">//key为文件名，value为文件的单词总数</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Integer&gt; wordinfiles = <span class="keyword">new</span> HashMap&lt;String, Integer&gt;();<span class="comment">//key为单词，value为单词在多少的文件中出现</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; indexes = <span class="keyword">new</span> HashMap&lt;String, String&gt;();<span class="comment">//key为单词，value为倒排索引</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;Text&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//拆分输入，获取单词出现在几个文件中以及在该文件中出现次数，各个文件的单词总数，总文件数</span></span><br><span class="line">        <span class="keyword">for</span> (Text val : values) &#123;</span><br><span class="line">            String valStr = val.toString();</span><br><span class="line">            String[] records = valStr.split(<span class="string">"\001"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">switch</span> (records.length) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    filescount.put(records[<span class="number">0</span>], Integer.parseInt(records[<span class="number">1</span>]));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>: &#123;</span><br><span class="line">                    wordinfilescount.put(valStr, Integer.parseInt(records[<span class="number">2</span>]));</span><br><span class="line">                    <span class="keyword">if</span> (!wordinfiles.containsKey(records[<span class="number">1</span>])) &#123;</span><br><span class="line">                        wordinfiles.put(records[<span class="number">1</span>], <span class="number">1</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        wordinfiles.put(records[<span class="number">1</span>], wordinfiles.get(records[<span class="number">1</span>]) + <span class="number">1</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                ;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//处理获取倒排索引</span></span><br><span class="line">        <span class="keyword">for</span> (Entry&lt;String, Integer&gt; entry : wordinfilescount.entrySet()) &#123;</span><br><span class="line">            String valStr = entry.getKey();</span><br><span class="line">            String[] records = valStr.split(<span class="string">"\001"</span>);</span><br><span class="line">            String word = records[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (!indexes.containsKey(word)) &#123;</span><br><span class="line">                StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                sb.append(word)</span><br><span class="line">                        .append(<span class="string">"-&gt;"</span>)</span><br><span class="line">                        .append(wordinfiles.get(word))</span><br><span class="line">                        .append(<span class="string">":"</span>)</span><br><span class="line">                        .append(<span class="string">"&#123;("</span>)</span><br><span class="line">                        .append(records[<span class="number">0</span>])</span><br><span class="line">                        .append(<span class="string">","</span>)</span><br><span class="line">                        .append(entry.getValue())</span><br><span class="line">                        .append(<span class="string">","</span>)</span><br><span class="line">                        .append(filescount.get(records[<span class="number">0</span>]))</span><br><span class="line">                        .append(<span class="string">")"</span>);</span><br><span class="line">                indexes.put(word, sb.toString());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                sb.append(<span class="string">",("</span>)</span><br><span class="line">                        .append(records[<span class="number">0</span>])</span><br><span class="line">                        .append(<span class="string">","</span>)</span><br><span class="line">                        .append(entry.getValue())</span><br><span class="line">                        .append(<span class="string">","</span>)</span><br><span class="line">                        .append(filescount.get(records[<span class="number">0</span>]))</span><br><span class="line">                        .append(<span class="string">")"</span>);</span><br><span class="line">                indexes.put(word, indexes.get(word) + sb.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (Entry&lt;String, String&gt; entry : indexes.entrySet()) &#123;</span><br><span class="line">            context.write(<span class="keyword">new</span> Text(entry.getValue() + <span class="string">"&#125;"</span>), NullWritable.get());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="完整源代码"><a href="#完整源代码" class="headerlink" title="完整源代码"></a>完整源代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.StringTokenizer;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map.Entry;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper.Context;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileSplit;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.GenericOptionsParser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InverseIndex</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 第一个mr的map类，获取每个单词在单个文件中出现次数，输入为每个文件行偏移量，输出为&lt;word+filename,1&gt;</span></span><br><span class="line"><span class="comment">     * 或&lt;filename,1&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">statisticsMap</span> <span class="keyword">extends</span></span></span><br><span class="line"><span class="class">            <span class="title">Mapper</span>&lt;<span class="title">Object</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Text mapKey = <span class="keyword">new</span> Text(<span class="string">"key"</span>);</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(Object key, Text value, Context context)</span></span></span><br><span class="line"><span class="function">                <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            <span class="comment">//获取文件名</span></span><br><span class="line">            FileSplit fileSplit= (FileSplit)context.getInputSplit();</span><br><span class="line">            String fileName = fileSplit.getPath().getName();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//获取单词在单个文件中出现次数，及文件单词总数</span></span><br><span class="line">            StringTokenizer itr= <span class="keyword">new</span> StringTokenizer(value.toString());</span><br><span class="line">            <span class="keyword">for</span>(; itr.hasMoreTokens(); ) &#123;</span><br><span class="line">                String word =removeNonLetters( itr.nextToken().toLowerCase());</span><br><span class="line">                String fileWord = fileName+<span class="string">"\001"</span>+word;</span><br><span class="line">                <span class="keyword">if</span>(!word.equals(<span class="string">""</span>))&#123;</span><br><span class="line">                    context.write(<span class="keyword">new</span> Text(fileWord), <span class="keyword">new</span> IntWritable(<span class="number">1</span>));</span><br><span class="line">                    context.write(<span class="keyword">new</span> Text(fileName), <span class="keyword">new</span> IntWritable(<span class="number">1</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//去掉字符串非字母字符</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">removeNonLetters</span><span class="params">(String original)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">            StringBuffer aBuffer=<span class="keyword">new</span> StringBuffer(original.length());</span><br><span class="line">            <span class="keyword">char</span> aCharacter;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;original.length();i++)&#123;</span><br><span class="line">                aCharacter=original.charAt(i);</span><br><span class="line">                <span class="keyword">if</span>(Character.isLetter(aCharacter))&#123;</span><br><span class="line">                    aBuffer.append(aCharacter);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String(aBuffer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第一个mr的reduce类，统计汇总出现单词的文件个数，及每个文件中单词出现个数及每个文件单词个数,</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">statisticsReduce</span> <span class="keyword">extends</span></span></span><br><span class="line"><span class="class">            <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">IntWritable</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values, Context context)</span></span></span><br><span class="line"><span class="function">                <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (IntWritable val : values) &#123;</span><br><span class="line">                sum += val.get();</span><br><span class="line">            &#125;</span><br><span class="line">            context.write(key,<span class="keyword">new</span> IntWritable(sum));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InverseMapper</span> <span class="keyword">extends</span></span></span><br><span class="line"><span class="class">            <span class="title">Mapper</span>&lt;<span class="title">Object</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(Object key, Text value, Context context)</span></span></span><br><span class="line"><span class="function">                <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            String valStr = value.toString();</span><br><span class="line">            String[] records = valStr.split(<span class="string">"\t"</span>);</span><br><span class="line">            context.write(<span class="keyword">new</span> Text(<span class="string">"index"</span>),<span class="keyword">new</span> Text(records[<span class="number">0</span>]+<span class="string">"\001"</span>+records[<span class="number">1</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span>  <span class="title">InverseReducer</span> <span class="keyword">extends</span></span></span><br><span class="line"><span class="class">            <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">NullWritable</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Map&lt;String,Integer&gt; wordinfilescount = <span class="keyword">new</span> HashMap&lt;String,Integer&gt;();<span class="comment">//key为单词+文件名，value为单词在该文件中出现的次数</span></span><br><span class="line">        <span class="keyword">private</span> Map&lt;String,Integer&gt; filescount = <span class="keyword">new</span> HashMap&lt;String,Integer&gt;();<span class="comment">//key为文件名，value为文件的单词总数</span></span><br><span class="line">        <span class="keyword">private</span> Map&lt;String,Integer&gt; wordinfiles = <span class="keyword">new</span> HashMap&lt;String,Integer&gt;();<span class="comment">//key为单词，value为单词在多少的文件中出现</span></span><br><span class="line">        <span class="keyword">private</span> Map&lt;String,String&gt; indexes = <span class="keyword">new</span> HashMap&lt;String,String&gt;();<span class="comment">//key为单词，value为倒排索引</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">( Text  key, Iterable&lt;Text&gt;  values, Context context)</span></span></span><br><span class="line"><span class="function">                <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            <span class="comment">//拆分输入，获取单词出现在几个文件中以及在该文件中出现次数，各个文件的单词总数，总文件数</span></span><br><span class="line">            <span class="keyword">for</span> (Text val : values) &#123;</span><br><span class="line">                String valStr = val.toString();</span><br><span class="line">                String[] records = valStr.split(<span class="string">"\001"</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">switch</span>(records.length)&#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">2</span>:filescount.put(records[<span class="number">0</span>], Integer.parseInt(records[<span class="number">1</span>]));</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">3</span>:&#123;</span><br><span class="line">                        wordinfilescount.put(valStr,  Integer.parseInt(records[<span class="number">2</span>]));</span><br><span class="line">                        <span class="keyword">if</span>(!wordinfiles.containsKey(records[<span class="number">1</span>]))&#123;</span><br><span class="line">                            wordinfiles.put(records[<span class="number">1</span>], <span class="number">1</span>);</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            wordinfiles.put(records[<span class="number">1</span>], wordinfiles.get(records[<span class="number">1</span>])+<span class="number">1</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//处理获取倒排索引</span></span><br><span class="line">            <span class="keyword">for</span> (Entry&lt;String, Integer&gt; entry : wordinfilescount.entrySet()) &#123;</span><br><span class="line">                String valStr = entry.getKey();</span><br><span class="line">                String[] records = valStr.split(<span class="string">"\001"</span>);</span><br><span class="line">                String word = records[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">if</span>(!indexes.containsKey(word))&#123;</span><br><span class="line">                    StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                    sb.append(word)</span><br><span class="line">                            .append(<span class="string">"-&gt;"</span>)</span><br><span class="line">                            .append(wordinfiles.get(word))</span><br><span class="line">                            .append(<span class="string">":"</span>)</span><br><span class="line">                            .append(<span class="string">"&#123;("</span>)</span><br><span class="line">                            .append( records[<span class="number">0</span>])</span><br><span class="line">                            .append(<span class="string">","</span>)</span><br><span class="line">                            .append(entry.getValue())</span><br><span class="line">                            .append(<span class="string">","</span>)</span><br><span class="line">                            .append(filescount.get( records[<span class="number">0</span>]))</span><br><span class="line">                            .append(<span class="string">")"</span>);</span><br><span class="line">                    indexes.put(word,sb.toString() );</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                    sb.append(<span class="string">",("</span>)</span><br><span class="line">                            .append( records[<span class="number">0</span>])</span><br><span class="line">                            .append(<span class="string">","</span>)</span><br><span class="line">                            .append(entry.getValue())</span><br><span class="line">                            .append(<span class="string">","</span>)</span><br><span class="line">                            .append(filescount.get( records[<span class="number">0</span>]))</span><br><span class="line">                            .append(<span class="string">")"</span>);</span><br><span class="line">                    indexes.put(word,indexes.get(word)+sb.toString() );</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (Entry&lt;String, String&gt; entry : indexes.entrySet()) &#123;</span><br><span class="line">                context.write(<span class="keyword">new</span> Text(entry.getValue()+<span class="string">"&#125;"</span>), NullWritable.get());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//统计单词在文件中出现次数及单个文件单词总数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">StatisticsTask</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        String[] otherArgs = <span class="keyword">new</span> GenericOptionsParser(conf, args)</span><br><span class="line">                .getRemainingArgs();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (otherArgs.length &lt; <span class="number">3</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">"Usage: ipstatistics &lt;in&gt; [&lt;in&gt;...] &lt;out&gt;"</span>);</span><br><span class="line">            System.exit(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Job job = <span class="keyword">new</span> Job(conf, <span class="string">"ipstatistics1"</span>);</span><br><span class="line">        job.setMapperClass(statisticsMap<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setReducerClass(statisticsReduce<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputKeyClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputValueClass(IntWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        FileInputFormat.addInputPath(job, <span class="keyword">new</span> Path(otherArgs[<span class="number">0</span>]));</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(</span><br><span class="line">                otherArgs[<span class="number">1</span>]));</span><br><span class="line">        job.waitForCompletion(<span class="keyword">true</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//根据统计结果输出倒排索引</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span>  <span class="title">InverseTask</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        String[] otherArgs = <span class="keyword">new</span> GenericOptionsParser(conf, args)</span><br><span class="line">                .getRemainingArgs();</span><br><span class="line">        <span class="keyword">if</span> (otherArgs.length &lt; <span class="number">3</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">"Usage: ipstatistics &lt;in&gt; [&lt;in&gt;...] &lt;out&gt;"</span>);</span><br><span class="line">            System.exit(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Job job = <span class="keyword">new</span> Job(conf, <span class="string">"ipstatistics2"</span>);</span><br><span class="line">        job.setMapperClass( InverseMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setReducerClass( InverseReducer<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputKeyClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputValueClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        FileInputFormat.addInputPath(job, <span class="keyword">new</span> Path(otherArgs[<span class="number">1</span>]));</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(</span><br><span class="line">                otherArgs[<span class="number">2</span>]));</span><br><span class="line">        System.exit(job.waitForCompletion(<span class="keyword">true</span>) ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        StatisticsTask(args);</span><br><span class="line">        InverseTask(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="部署运行"><a href="#部署运行" class="headerlink" title="部署运行"></a>部署运行</h2><ul>
<li>启动Hadoop集群</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@gbh:/usr/local/big_data/homework/MapReduce/InvertedIndex<span class="comment"># start-all.sh</span></span><br></pre></td></tr></table></figure>

<ul>
<li>编译源码<br>切换工作目录并编译</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@gbh:/usr/local/big_data/homework/MapReduce/InvertedIndex<span class="comment"># javac -d bin/ src/InverseIndex.java</span></span><br></pre></td></tr></table></figure>
<p>报了一个错误：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">src/InverseIndex.java:<span class="number">8</span>: error: package org.apache.hadoop.conf does not exist</span><br><span class="line">import org.apache.hadoop.conf.Configuration;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>这个错误是因为CLASSPATH环境变量没配置对，在~/.bashrc的末尾添加如下语句：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br><span class="line"><span class="comment">#在末尾添加如下一句</span></span><br><span class="line">eexport CLASSPATH=<span class="variable">$</span>(<span class="variable">$HADOOP_HOME</span>/bin/hadoop classpath):<span class="variable">$CLASSPATH</span></span><br></pre></td></tr></table></figure>
<p>保存退出，通过下面的命令使修改生效</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>
<p>重新编译</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@gbh:/usr/local/big_data/homework/MapReduce/InvertedIndex<span class="comment"># javac -d bin/ src/InverseIndex.java</span></span><br></pre></td></tr></table></figure>
<p>可以看到bin目录下生成了编译后的文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@gbh:/usr/local/big_data/homework/MapReduce/InvertedIndex<span class="comment"># ls bin/ -lh</span></span><br><span class="line">total <span class="number">24</span>K</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>-- <span class="number">1</span> root root <span class="number">2.3</span>K <span class="number">12</span>月 <span class="number">25</span> <span class="number">20</span>:<span class="number">02</span>  InverseIndex<span class="class">.<span class="keyword">class</span></span></span><br><span class="line"><span class="class">-<span class="title">rw</span>-<span class="title">r</span>--<span class="title">r</span>-- 1 <span class="title">root</span> <span class="title">root</span> 1.9<span class="title">K</span> 12月 25 20:02 '<span class="title">InverseIndex</span>$<span class="title">InverseMapper</span>.<span class="title">class</span>'</span></span><br><span class="line"><span class="class">-<span class="title">rw</span>-<span class="title">r</span>--<span class="title">r</span>-- 1 <span class="title">root</span> <span class="title">root</span> 4.1<span class="title">K</span> 12月 25 20:02 '<span class="title">InverseIndex</span>$<span class="title">InverseReducer</span>.<span class="title">class</span>'</span></span><br><span class="line"><span class="class">-<span class="title">rw</span>-<span class="title">r</span>--<span class="title">r</span>-- 1 <span class="title">root</span> <span class="title">root</span> 2.9<span class="title">K</span> 12月 25 20:02 '<span class="title">InverseIndex</span>$<span class="title">statisticsMap</span>.<span class="title">class</span>'</span></span><br><span class="line"><span class="class">-<span class="title">rw</span>-<span class="title">r</span>--<span class="title">r</span>-- 1 <span class="title">root</span> <span class="title">root</span> 1.7<span class="title">K</span> 12月 25 20:02 '<span class="title">InverseIndex</span>$<span class="title">statisticsReduce</span>.<span class="title">class</span>'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>打包jar文件</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">jar <span class="literal">-cvf</span> InverseIndex.jar <span class="literal">-C</span> bin/ .</span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line">added manifest</span><br><span class="line">adding: InverseIndex<span class="variable">$InverseReducer</span><span class="class">.<span class="keyword">class</span>(<span class="title">in</span> = 4186) (<span class="title">out</span>= 1820)(<span class="title">deflated</span> 56%)</span></span><br><span class="line"><span class="class"><span class="title">adding</span>: <span class="title">InverseIndex</span>.<span class="title">class</span>(<span class="title">in</span> = 2282) (<span class="title">out</span>= 1160)(<span class="title">deflated</span> 49%)</span></span><br><span class="line"><span class="class"><span class="title">adding</span>: <span class="title">InverseIndex</span>$<span class="title">InverseMapper</span>.<span class="title">class</span>(<span class="title">in</span> = 1909) (<span class="title">out</span>= 771)(<span class="title">deflated</span> 59%)</span></span><br><span class="line"><span class="class"><span class="title">adding</span>: <span class="title">InverseIndex</span>$<span class="title">statisticsMap</span>.<span class="title">class</span>(<span class="title">in</span> = 2960) (<span class="title">out</span>= 1371)(<span class="title">deflated</span> 53%)</span></span><br><span class="line"><span class="class"><span class="title">adding</span>: <span class="title">InverseIndex</span>$<span class="title">statisticsReduce</span>.<span class="title">class</span>(<span class="title">in</span> = 1672) (<span class="title">out</span>= 714)(<span class="title">deflated</span> 57%)</span></span><br></pre></td></tr></table></figure>

<ul>
<li>上传输入文件<br>在HDFS中创建input目录，用于存储输入文件</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs <span class="literal">-mkdir</span> input</span><br></pre></td></tr></table></figure>
<p>将输入文件从本地拷贝到HDFS的input目录</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs <span class="literal">-put</span> /usr/local/big_data/homework/<span class="keyword">data</span>/<span class="number">0</span>ws*.txt input</span><br></pre></td></tr></table></figure>
<p>查看是否拷贝成功</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">root@gbh:/usr/local/big_data/homework/MapReduce/InvertedIndex<span class="comment"># hadoop fs -ls input/</span></span><br><span class="line">WARNING: An illegal reflective access operation has occurred</span><br><span class="line">WARNING: Illegal reflective access by org.apache.hadoop.security.authentication.util.KerberosUtil (file:/usr/local/hadoop/share/hadoop/common/lib/hadoop<span class="literal">-auth</span><span class="literal">-2</span>.<span class="number">7.4</span>.jar) to method sun.security.krb5.Config.getInstance()</span><br><span class="line">WARNING: Please consider reporting this to the maintainers of org.apache.hadoop.security.authentication.util.KerberosUtil</span><br><span class="line">WARNING: Use -<span class="literal">-illegal</span><span class="literal">-access</span>=warn to enable warnings of further illegal reflective access operations</span><br><span class="line">WARNING: All illegal access operations will be denied <span class="keyword">in</span> a future release</span><br><span class="line">Found <span class="number">35</span> items</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">146884</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws0110.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">166807</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws0210.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">161786</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws0310.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">189377</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws0410.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">101367</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws0610.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">136652</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws0910.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">138374</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws1010.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">117959</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws1110.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">143801</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws1210.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">137832</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws1410.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">145078</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws1510.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">156279</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws1610.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">112280</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws1710.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">137320</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws1810.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">159175</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws1910.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">142894</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws2010.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">169826</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws2110.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">139007</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws2210.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">170479</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws2310.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">132199</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws2410.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">140595</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws2510.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">184147</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws2610.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">130617</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws2810.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">150544</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws3010.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">143937</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws3110.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">172030</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws3210.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">158008</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws3310.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">119985</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws3410.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">165919</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws3510.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">181370</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws3610.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">126492</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws3710.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">177241</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws3910.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">161652</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws4010.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">115675</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws4110.txt</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup     <span class="number">160868</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">13</span>:<span class="number">45</span> input/<span class="number">0</span>ws4210.txt</span><br></pre></td></tr></table></figure>
<p>可以看到输入文件已经拷贝成功。其中的警告信息是因为java版本太高，并不影响hadoop的正常使用，可以忽略。</p>
<ul>
<li>运行Jar文件</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop jar InverseIndex.jar InverseIndex input tmp output</span><br></pre></td></tr></table></figure>
<p>其中， input 是存储输入文件的目录； tmp 存储的是第一个 map/reduce的输出，也是第二个 map/reduce 的输入； output 存储的第二个map/reduce 的输出，也就是最终结果。<br><strong>Note：tmp和output目录不能事先创建好，如果事先创建好，会报类似下面的错误</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">root@gbh:/usr/local/big_data/homework/MapReduce/InvertedIndex<span class="comment"># hadoop jar InvertedIndex.jar InvertedIndex input invertedindex/output</span></span><br><span class="line">WARNING: An illegal reflective access operation has occurred</span><br><span class="line">WARNING: Illegal reflective access by org.apache.hadoop.security.authentication.util.KerberosUtil (file:/usr/local/hadoop/share/hadoop/common/lib/hadoop<span class="literal">-auth</span><span class="literal">-2</span>.<span class="number">7.4</span>.jar) to method sun.security.krb5.Config.getInstance()</span><br><span class="line">WARNING: Please consider reporting this to the maintainers of org.apache.hadoop.security.authentication.util.KerberosUtil</span><br><span class="line">WARNING: Use -<span class="literal">-illegal</span><span class="literal">-access</span>=warn to enable warnings of further illegal reflective access operations</span><br><span class="line">WARNING: All illegal access operations will be denied <span class="keyword">in</span> a future release</span><br><span class="line"><span class="number">19</span>/<span class="number">12</span>/<span class="number">25</span> <span class="number">14</span>:<span class="number">21</span>:<span class="number">37</span> INFO Configuration.deprecation: session.id is deprecated. Instead, use dfs.metrics.session<span class="literal">-id</span></span><br><span class="line"><span class="number">19</span>/<span class="number">12</span>/<span class="number">25</span> <span class="number">14</span>:<span class="number">21</span>:<span class="number">37</span> INFO jvm.JvmMetrics: Initializing JVM Metrics with processName=JobTracker, sessionId=</span><br><span class="line">Exception <span class="keyword">in</span> thread <span class="string">"main"</span> org.apache.hadoop.mapred.FileAlreadyExistsException: Output directory hdfs://localhost:<span class="number">9000</span>/user/root/invertedindex/output already exists</span><br><span class="line">	at org.apache.hadoop.mapreduce.lib.output.FileOutputFormat.checkOutputSpecs(FileOutputFormat.java:<span class="number">146</span>)</span><br><span class="line">	at org.apache.hadoop.mapreduce.JobSubmitter.checkSpecs(JobSubmitter.java:<span class="number">266</span>)</span><br><span class="line">	at org.apache.hadoop.mapreduce.JobSubmitter.submitJobInternal(JobSubmitter.java:<span class="number">139</span>)</span><br><span class="line">	at org.apache.hadoop.mapreduce.Job<span class="variable">$10</span>.run(Job.java:<span class="number">1290</span>)</span><br><span class="line">	at org.apache.hadoop.mapreduce.Job<span class="variable">$10</span>.run(Job.java:<span class="number">1287</span>)</span><br><span class="line">	at java.base/java.security.AccessController.doPrivileged(AccessController.java:<span class="number">691</span>)</span><br><span class="line">	at java.base/javax.security.auth.Subject.doAs(Subject.java:<span class="number">423</span>)</span><br><span class="line">	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:<span class="number">1746</span>)</span><br><span class="line">	at org.apache.hadoop.mapreduce.Job.submit(Job.java:<span class="number">1287</span>)</span><br><span class="line">	at org.apache.hadoop.mapreduce.Job.waitForCompletion(Job.java:<span class="number">1308</span>)</span><br><span class="line">	at InvertedIndex.main(InvertedIndex.java:<span class="number">120</span>)</span><br><span class="line">	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class="number">62</span>)</span><br><span class="line">	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="number">43</span>)</span><br><span class="line">	at java.base/java.lang.reflect.Method.invoke(Method.java:<span class="number">567</span>)</span><br><span class="line">	at org.apache.hadoop.util.RunJar.run(RunJar.java:<span class="number">221</span>)</span><br><span class="line">	at org.apache.hadoop.util.RunJar.main(RunJar.java:<span class="number">136</span>)</span><br></pre></td></tr></table></figure>
<p>存储输出文件的目录，系统会自己创建。</p>
<ul>
<li>查看输出结果<br>查看HDFS上output目录内容</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@gbh:/usr/local/big_data/homework/MapReduce/InvertedIndex<span class="comment"># hadoop fs -ls output/</span></span><br><span class="line">WARNING: An illegal reflective access operation has occurred</span><br><span class="line">WARNING: Illegal reflective access by org.apache.hadoop.security.authentication.util.KerberosUtil (file:/usr/local/hadoop/share/hadoop/common/lib/hadoop<span class="literal">-auth</span><span class="literal">-2</span>.<span class="number">7.4</span>.jar) to method sun.security.krb5.Config.getInstance()</span><br><span class="line">WARNING: Please consider reporting this to the maintainers of org.apache.hadoop.security.authentication.util.KerberosUtil</span><br><span class="line">WARNING: Use -<span class="literal">-illegal</span><span class="literal">-access</span>=warn to enable warnings of further illegal reflective access operations</span><br><span class="line">WARNING: All illegal access operations will be denied <span class="keyword">in</span> a future release</span><br><span class="line">Found <span class="number">2</span> items</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup          <span class="number">0</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">16</span>:<span class="number">38</span> output/_SUCCESS</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup    <span class="number">3821132</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-25</span> <span class="number">16</span>:<span class="number">38</span> output/part<span class="literal">-r</span><span class="literal">-00000</span></span><br></pre></td></tr></table></figure>
<p>output目录下的part-r-00000文件就是存储的最终输出结果。</p>
<ul>
<li>查看结果输出文件内容</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs <span class="literal">-cat</span> output/part<span class="literal">-r</span><span class="literal">-00000</span></span><br></pre></td></tr></table></figure>
<p>可以看到输出如下内容（截取部分）</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">broach-&gt;<span class="number">4</span>:&#123;(<span class="number">0</span>ws0110.txt,<span class="number">1</span>,<span class="number">24700</span>),(<span class="number">0</span>ws3710.txt,<span class="number">1</span>,<span class="number">21558</span>),(<span class="number">0</span>ws4210.txt,<span class="number">1</span>,<span class="number">27895</span>),(<span class="number">0</span>ws0910.txt,<span class="number">1</span>,<span class="number">23692</span>)&#125;</span><br><span class="line">throgh-&gt;<span class="number">1</span>:&#123;(<span class="number">0</span>ws1010.txt,<span class="number">1</span>,<span class="number">24377</span>)&#125;</span><br><span class="line">lustier-&gt;<span class="number">3</span>:&#123;(<span class="number">0</span>ws1910.txt,<span class="number">1</span>,<span class="number">27807</span>),(<span class="number">0</span>ws1610.txt,<span class="number">1</span>,<span class="number">27734</span>),(<span class="number">0</span>ws3010.txt,<span class="number">1</span>,<span class="number">26502</span>)&#125;</span><br><span class="line">instances-&gt;<span class="number">6</span>:&#123;(<span class="number">0</span>ws2510.txt,<span class="number">1</span>,<span class="number">25060</span>),(<span class="number">0</span>ws1110.txt,<span class="number">1</span>,<span class="number">20592</span>),(<span class="number">0</span>ws2210.txt,<span class="number">1</span>,<span class="number">24615</span>),(<span class="number">0</span>ws2410.txt,<span class="number">1</span>,<span class="number">22949</span>),(<span class="number">0</span>ws2110.txt,<span class="number">1</span>,<span class="number">29220</span>),(<span class="number">0</span>ws2610.txt,<span class="number">1</span>,<span class="number">32135</span>)&#125;</span><br><span class="line">stout-&gt;<span class="number">12</span>:&#123;(<span class="number">0</span>ws0310.txt,<span class="number">2</span>,<span class="number">27573</span>),(<span class="number">0</span>ws0410.txt,<span class="number">1</span>,<span class="number">32588</span>),(<span class="number">0</span>ws3610.txt,<span class="number">1</span>,<span class="number">31061</span>),(<span class="number">0</span>ws1610.txt,<span class="number">2</span>,<span class="number">27734</span>),(<span class="number">0</span>ws4210.txt,<span class="number">1</span>,<span class="number">27895</span>),(<span class="number">0</span>ws3710.txt,<span class="number">1</span>,<span class="number">21558</span>),(<span class="number">0</span>ws3410.txt,<span class="number">1</span>,<span class="number">20206</span>),(<span class="number">0</span>ws0210.txt,<span class="number">2</span>,<span class="number">28689</span>),(<span class="number">0</span>ws2810.txt,<span class="number">1</span>,<span class="number">23284</span>),(<span class="number">0</span>ws0110.txt,<span class="number">3</span>,<span class="number">24700</span>),(<span class="number">0</span>ws1410.txt,<span class="number">1</span>,<span class="number">23904</span>),(<span class="number">0</span>ws1910.txt,<span class="number">1</span>,<span class="number">27807</span>)&#125;</span><br><span class="line">iuliet-&gt;<span class="number">2</span>:&#123;(<span class="number">0</span>ws3110.txt,<span class="number">8</span>,<span class="number">25123</span>),(<span class="number">0</span>ws1610.txt,<span class="number">54</span>,<span class="number">27734</span>)&#125;</span><br><span class="line">flee-&gt;<span class="number">1</span>:&#123;(<span class="number">0</span>ws1210.txt,<span class="number">1</span>,<span class="number">24901</span>)&#125;</span><br><span class="line">fled-&gt;<span class="number">26</span>:&#123;(<span class="number">0</span>ws2010.txt,<span class="number">1</span>,<span class="number">24815</span>),(<span class="number">0</span>ws2210.txt,<span class="number">5</span>,<span class="number">24615</span>),(<span class="number">0</span>ws0410.txt,<span class="number">4</span>,<span class="number">32588</span>),(<span class="number">0</span>ws1410.txt,<span class="number">1</span>,<span class="number">23904</span>),(<span class="number">0</span>ws3710.txt,<span class="number">1</span>,<span class="number">21558</span>),(<span class="number">0</span>ws0610.txt,<span class="number">2</span>,<span class="number">17919</span>),(<span class="number">0</span>ws3910.txt,<span class="number">5</span>,<span class="number">30687</span>),(<span class="number">0</span>ws3010.txt,<span class="number">1</span>,<span class="number">26502</span>),(<span class="number">0</span>ws0910.txt,<span class="number">1</span>,<span class="number">23692</span>),(<span class="number">0</span>ws3510.txt,<span class="number">3</span>,<span class="number">28227</span>),(<span class="number">0</span>ws1910.txt,<span class="number">1</span>,<span class="number">27807</span>),(<span class="number">0</span>ws1710.txt,<span class="number">3</span>,<span class="number">19538</span>),(<span class="number">0</span>ws0210.txt,<span class="number">6</span>,<span class="number">28689</span>),(<span class="number">0</span>ws3310.txt,<span class="number">3</span>,<span class="number">27164</span>),(<span class="number">0</span>ws2110.txt,<span class="number">3</span>,<span class="number">29220</span>),(<span class="number">0</span>ws1510.txt,<span class="number">7</span>,<span class="number">24965</span>),(<span class="number">0</span>ws3610.txt,<span class="number">1</span>,<span class="number">31061</span>),(<span class="number">0</span>ws3210.txt,<span class="number">2</span>,<span class="number">29959</span>),(<span class="number">0</span>ws1110.txt,<span class="number">3</span>,<span class="number">20592</span>),(<span class="number">0</span>ws4010.txt,<span class="number">3</span>,<span class="number">28122</span>),(<span class="number">0</span>ws3410.txt,<span class="number">7</span>,<span class="number">20206</span>),(<span class="number">0</span>ws0110.txt,<span class="number">8</span>,<span class="number">24700</span>),(<span class="number">0</span>ws1610.txt,<span class="number">2</span>,<span class="number">27734</span>),(<span class="number">0</span>ws0310.txt,<span class="number">8</span>,<span class="number">27573</span>),(<span class="number">0</span>ws1810.txt,<span class="number">1</span>,<span class="number">24517</span>),(<span class="number">0</span>ws2410.txt,<span class="number">3</span>,<span class="number">22949</span>)&#125;</span><br><span class="line">hedgd-&gt;<span class="number">2</span>:&#123;(<span class="number">0</span>ws1810.txt,<span class="number">1</span>,<span class="number">24517</span>),(<span class="number">0</span>ws1410.txt,<span class="number">1</span>,<span class="number">23904</span>)&#125;</span><br><span class="line">hedge-&gt;<span class="number">10</span>:&#123;(<span class="number">0</span>ws1910.txt,<span class="number">1</span>,<span class="number">27807</span>),(<span class="number">0</span>ws3010.txt,<span class="number">1</span>,<span class="number">26502</span>),(<span class="number">0</span>ws2410.txt,<span class="number">1</span>,<span class="number">22949</span>),(<span class="number">0</span>ws1010.txt,<span class="number">1</span>,<span class="number">24377</span>),(<span class="number">0</span>ws0210.txt,<span class="number">1</span>,<span class="number">28689</span>),(<span class="number">0</span>ws2210.txt,<span class="number">1</span>,<span class="number">24615</span>),(<span class="number">0</span>ws3510.txt,<span class="number">1</span>,<span class="number">28227</span>),(<span class="number">0</span>ws2010.txt,<span class="number">1</span>,<span class="number">24815</span>),(<span class="number">0</span>ws2610.txt,<span class="number">1</span>,<span class="number">32135</span>),(<span class="number">0</span>ws4010.txt,<span class="number">2</span>,<span class="number">28122</span>)&#125;</span><br><span class="line">flea-&gt;<span class="number">5</span>:&#123;(<span class="number">0</span>ws1210.txt,<span class="number">1</span>,<span class="number">24901</span>),(<span class="number">0</span>ws1010.txt,<span class="number">1</span>,<span class="number">24377</span>),(<span class="number">0</span>ws2310.txt,<span class="number">2</span>,<span class="number">29377</span>),(<span class="number">0</span>ws3310.txt,<span class="number">1</span>,<span class="number">27164</span>),(<span class="number">0</span>ws2810.txt,<span class="number">1</span>,<span class="number">23284</span>)&#125;</span><br><span class="line">taxing-&gt;<span class="number">1</span>:&#123;(<span class="number">0</span>ws2510.txt,<span class="number">1</span>,<span class="number">25060</span>)&#125;</span><br><span class="line">responsiue-&gt;<span class="number">1</span>:&#123;(<span class="number">0</span>ws2610.txt,<span class="number">1</span>,<span class="number">32135</span>)&#125;</span><br><span class="line">flew-&gt;<span class="number">4</span>:&#123;(<span class="number">0</span>ws0210.txt,<span class="number">1</span>,<span class="number">28689</span>),(<span class="number">0</span>ws3310.txt,<span class="number">1</span>,<span class="number">27164</span>),(<span class="number">0</span>ws4210.txt,<span class="number">1</span>,<span class="number">27895</span>),(<span class="number">0</span>ws1810.txt,<span class="number">1</span>,<span class="number">24517</span>)&#125;</span><br><span class="line">treuant-&gt;<span class="number">1</span>:&#123;(<span class="number">0</span>ws1210.txt,<span class="number">1</span>,<span class="number">24901</span>)&#125;</span><br><span class="line">commandment-&gt;<span class="number">5</span>:&#123;(<span class="number">0</span>ws2610.txt,<span class="number">4</span>,<span class="number">32135</span>),(<span class="number">0</span>ws4010.txt,<span class="number">1</span>,<span class="number">28122</span>),(<span class="number">0</span>ws3610.txt,<span class="number">1</span>,<span class="number">31061</span>),(<span class="number">0</span>ws2110.txt,<span class="number">1</span>,<span class="number">29220</span>),(<span class="number">0</span>ws2510.txt,<span class="number">1</span>,<span class="number">25060</span>)&#125;</span><br><span class="line">sailemaker-&gt;<span class="number">1</span>:&#123;(<span class="number">0</span>ws1010.txt,<span class="number">1</span>,<span class="number">24377</span>)&#125;</span><br><span class="line">carried-&gt;<span class="number">16</span>:&#123;(<span class="number">0</span>ws3910.txt,<span class="number">1</span>,<span class="number">30687</span>),(<span class="number">0</span>ws2610.txt,<span class="number">1</span>,<span class="number">32135</span>),(<span class="number">0</span>ws1710.txt,<span class="number">1</span>,<span class="number">19538</span>),(<span class="number">0</span>ws3510.txt,<span class="number">1</span>,<span class="number">28227</span>),(<span class="number">0</span>ws2010.txt,<span class="number">1</span>,<span class="number">24815</span>),(<span class="number">0</span>ws2210.txt,<span class="number">1</span>,<span class="number">24615</span>),(<span class="number">0</span>ws0610.txt,<span class="number">2</span>,<span class="number">17919</span>),(<span class="number">0</span>ws3310.txt,<span class="number">1</span>,<span class="number">27164</span>),(<span class="number">0</span>ws1110.txt,<span class="number">1</span>,<span class="number">20592</span>),(<span class="number">0</span>ws3110.txt,<span class="number">4</span>,<span class="number">25123</span>),(<span class="number">0</span>ws4210.txt,<span class="number">2</span>,<span class="number">27895</span>),(<span class="number">0</span>ws3610.txt,<span class="number">2</span>,<span class="number">31061</span>),(<span class="number">0</span>ws1210.txt,<span class="number">1</span>,<span class="number">24901</span>),(<span class="number">0</span>ws3410.txt,<span class="number">1</span>,<span class="number">20206</span>),(<span class="number">0</span>ws3010.txt,<span class="number">2</span>,<span class="number">26502</span>),(<span class="number">0</span>ws2310.txt,<span class="number">1</span>,<span class="number">29377</span>)&#125;</span><br><span class="line">auoiding-&gt;<span class="number">1</span>:&#123;(<span class="number">0</span>ws0310.txt,<span class="number">1</span>,<span class="number">27573</span>)&#125;</span><br><span class="line">inthrald-&gt;<span class="number">1</span>:&#123;(<span class="number">0</span>ws0110.txt,<span class="number">1</span>,<span class="number">24700</span>)&#125;</span><br><span class="line">clearenesse-&gt;<span class="number">1</span>:&#123;(<span class="number">0</span>ws3410.txt,<span class="number">1</span>,<span class="number">20206</span>)&#125;</span><br><span class="line">blithe-&gt;<span class="number">2</span>:&#123;(<span class="number">0</span>ws2210.txt,<span class="number">1</span>,<span class="number">24615</span>),(<span class="number">0</span>ws0910.txt,<span class="number">1</span>,<span class="number">23692</span>)&#125;</span><br><span class="line">clothes-&gt;<span class="number">8</span>:&#123;(<span class="number">0</span>ws2310.txt,<span class="number">1</span>,<span class="number">29377</span>),(<span class="number">0</span>ws1010.txt,<span class="number">1</span>,<span class="number">24377</span>),(<span class="number">0</span>ws0110.txt,<span class="number">1</span>,<span class="number">24700</span>),(<span class="number">0</span>ws1610.txt,<span class="number">1</span>,<span class="number">27734</span>),(<span class="number">0</span>ws1910.txt,<span class="number">1</span>,<span class="number">27807</span>),(<span class="number">0</span>ws2610.txt,<span class="number">1</span>,<span class="number">32135</span>),(<span class="number">0</span>ws3110.txt,<span class="number">1</span>,<span class="number">25123</span>),(<span class="number">0</span>ws4010.txt,<span class="number">1</span>,<span class="number">28122</span>)&#125;</span><br><span class="line">raunge-&gt;<span class="number">2</span>:&#123;(<span class="number">0</span>ws1510.txt,<span class="number">1</span>,<span class="number">24965</span>),(<span class="number">0</span>ws2310.txt,<span class="number">1</span>,<span class="number">29377</span>)&#125;</span><br><span class="line">gonerill-&gt;<span class="number">1</span>:&#123;(<span class="number">0</span>ws3310.txt,<span class="number">18</span>,<span class="number">27164</span>)&#125;</span><br><span class="line">stowd-&gt;<span class="number">1</span>:&#123;(<span class="number">0</span>ws3210.txt,<span class="number">1</span>,<span class="number">29959</span>)&#125;</span><br><span class="line">carrier-&gt;<span class="number">2</span>:&#123;(<span class="number">0</span>ws1910.txt,<span class="number">4</span>,<span class="number">27807</span>),(<span class="number">0</span>ws0910.txt,<span class="number">1</span>,<span class="number">23692</span>)&#125;</span><br><span class="line">carries-&gt;<span class="number">15</span>:&#123;(<span class="number">0</span>ws1910.txt,<span class="number">1</span>,<span class="number">27807</span>),(<span class="number">0</span>ws3710.txt,<span class="number">1</span>,<span class="number">21558</span>),(<span class="number">0</span>ws3510.txt,<span class="number">1</span>,<span class="number">28227</span>),(<span class="number">0</span>ws1710.txt,<span class="number">2</span>,<span class="number">19538</span>),(<span class="number">0</span>ws0610.txt,<span class="number">1</span>,<span class="number">17919</span>),(<span class="number">0</span>ws2410.txt,<span class="number">1</span>,<span class="number">22949</span>),(<span class="number">0</span>ws2610.txt,<span class="number">1</span>,<span class="number">32135</span>),(<span class="number">0</span>ws4210.txt,<span class="number">2</span>,<span class="number">27895</span>),(<span class="number">0</span>ws1810.txt,<span class="number">1</span>,<span class="number">24517</span>),(<span class="number">0</span>ws4110.txt,<span class="number">1</span>,<span class="number">19796</span>),(<span class="number">0</span>ws2510.txt,<span class="number">1</span>,<span class="number">25060</span>),(<span class="number">0</span>ws1210.txt,<span class="number">1</span>,<span class="number">24901</span>),(<span class="number">0</span>ws3610.txt,<span class="number">1</span>,<span class="number">31061</span>),(<span class="number">0</span>ws3010.txt,<span class="number">3</span>,<span class="number">26502</span>),(<span class="number">0</span>ws1610.txt,<span class="number">1</span>,<span class="number">27734</span>)&#125;</span><br><span class="line">obiections-&gt;<span class="number">3</span>:&#123;(<span class="number">0</span>ws0210.txt,<span class="number">1</span>,<span class="number">28689</span>),(<span class="number">0</span>ws4210.txt,<span class="number">1</span>,<span class="number">27895</span>),(<span class="number">0</span>ws0110.txt,<span class="number">1</span>,<span class="number">24700</span>)&#125;</span><br><span class="line">vnsuspected-&gt;<span class="number">2</span>:&#123;(<span class="number">0</span>ws0410.txt,<span class="number">1</span>,<span class="number">32588</span>),(<span class="number">0</span>ws1010.txt,<span class="number">1</span>,<span class="number">24377</span>)&#125;</span><br><span class="line">arguments-&gt;<span class="number">7</span>:&#123;(<span class="number">0</span>ws1210.txt,<span class="number">1</span>,<span class="number">24901</span>),(<span class="number">0</span>ws2810.txt,<span class="number">3</span>,<span class="number">23284</span>),(<span class="number">0</span>ws0310.txt,<span class="number">2</span>,<span class="number">27573</span>),(<span class="number">0</span>ws4210.txt,<span class="number">1</span>,<span class="number">27895</span>),(<span class="number">0</span>ws1410.txt,<span class="number">1</span>,<span class="number">23904</span>),(<span class="number">0</span>ws3310.txt,<span class="number">1</span>,<span class="number">27164</span>),(<span class="number">0</span>ws0410.txt,<span class="number">1</span>,<span class="number">32588</span>)&#125;</span><br><span class="line">shreds-&gt;<span class="number">2</span>:&#123;(<span class="number">0</span>ws3610.txt,<span class="number">1</span>,<span class="number">31061</span>),(<span class="number">0</span>ws2610.txt,<span class="number">1</span>,<span class="number">32135</span>)&#125;</span><br><span class="line">raunges-&gt;<span class="number">1</span>:&#123;(<span class="number">0</span>ws3610.txt,<span class="number">1</span>,<span class="number">31061</span>)&#125;</span><br></pre></td></tr></table></figure>


      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/25/Hadoop%E4%B9%8B%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95/" data-id="ck4l9vntf0000csvi1yy5f1m3"
        class="article-share-link">分享</a>
      
    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Ubuntu18-04下安装Hadoop单机与伪分布式环境" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/24/Ubuntu18-04%E4%B8%8B%E5%AE%89%E8%A3%85Hadoop%E5%8D%95%E6%9C%BA%E4%B8%8E%E4%BC%AA%E5%88%86%E5%B8%83%E5%BC%8F%E7%8E%AF%E5%A2%83/"
    >Ubuntu18.04下安装Hadoop单机与伪分布式环境</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/12/24/Ubuntu18-04%E4%B8%8B%E5%AE%89%E8%A3%85Hadoop%E5%8D%95%E6%9C%BA%E4%B8%8E%E4%BC%AA%E5%88%86%E5%B8%83%E5%BC%8F%E7%8E%AF%E5%A2%83/" class="article-date">
  <time datetime="2019-12-24T07:05:31.000Z" itemprop="datePublished">2019-12-24</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><ul>
<li><p>Ubuntu18.04/64-bit</p>
</li>
<li><p>Hadoop-2.7</p>
</li>
<li><p>JAVA JDK1.13.0.1</p>
<h2 id="安装JDK"><a href="#安装JDK" class="headerlink" title="安装JDK"></a>安装JDK</h2></li>
<li><p>从<a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk13-downloads-5672538.html" target="_blank" rel="noopener">这里</a>下载对应版本的JDK，选择Linux版本，记住自己下载的版本号，后面配置时候需要用到。</p>
</li>
<li><p>新建/usr/java目录，切换到所下载的jdk-13.0.1_linux-x64_bin.tar.gz目录。将文件解压到/usr/java目录下。</p>
</li>
</ul>
<p> <em>以下所有操作都以root用户登录</em></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar <span class="literal">-xzvf</span> jdk<span class="literal">-13</span>.<span class="number">0.1</span>_linux<span class="literal">-x64_bin</span>.tar.gz /usr/java/</span><br></pre></td></tr></table></figure>

<ul>
<li>配置环境变量<br>打开~/.bashrc文件，配置java环境变量<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure>
插入如下内容：</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/java/jdk<span class="literal">-13</span>.<span class="number">0.1</span></span><br><span class="line">export JRE_HOME=<span class="variable">$</span>&#123;JAVA_HOME&#125;/jre</span><br><span class="line">export CLASSPATH=.:<span class="variable">$</span>&#123;JAVA_HOME&#125;/lib:<span class="variable">$</span>&#123;JRE_HOME&#125;/lib</span><br><span class="line">export PATH=<span class="variable">$</span>&#123;JAVA_HOME&#125;/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>
<p>使环境变量生效</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>

<p>验证java环境是否配置成功</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java <span class="literal">-version</span></span><br><span class="line"><span class="comment">#输出如下内容，说明安装成功</span></span><br><span class="line">java version <span class="string">"13.0.1"</span> <span class="number">2019</span><span class="literal">-10</span><span class="literal">-15</span></span><br><span class="line">Java(TM) SE Runtime Environment (build <span class="number">13.0</span>.<span class="number">1</span>+<span class="number">9</span>)</span><br><span class="line">Java HotSpot(TM) <span class="number">64</span><span class="literal">-Bit</span> Server VM (build <span class="number">13.0</span>.<span class="number">1</span>+<span class="number">9</span>, mixed mode, sharing)</span><br></pre></td></tr></table></figure>
<h2 id="安装ssh-server并实现免密码登录"><a href="#安装ssh-server并实现免密码登录" class="headerlink" title="安装ssh-server并实现免密码登录"></a>安装ssh-server并实现免密码登录</h2><ul>
<li>安装ssh-server</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt<span class="literal">-get</span> install openssh<span class="literal">-server</span></span><br></pre></td></tr></table></figure>

<ul>
<li>启动ssh<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/ssh start</span><br></pre></td></tr></table></figure></li>
<li>查看ssh服务是否启动，如果显示相关ssh字样则表示成功</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ps <span class="literal">-ef</span>|grep ssh</span><br><span class="line"><span class="comment">#输出如下字样，说明启动成功</span></span><br><span class="line">gbh       <span class="number">2011</span>  <span class="number">1874</span>  <span class="number">0</span> <span class="number">09</span>:<span class="number">25</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> /usr/bin/ssh<span class="literal">-agent</span> /usr/bin/im<span class="literal">-launch</span> env GNOME_SHELL_SESSION_MODE=ubuntu gnome<span class="literal">-session</span> -<span class="literal">-session</span>=ubuntu</span><br><span class="line">root      <span class="number">5362</span>     <span class="number">1</span>  <span class="number">0</span> <span class="number">10</span>:<span class="number">46</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> /usr/sbin/sshd <span class="literal">-D</span></span><br><span class="line">gbh       <span class="number">6447</span>  <span class="number">3514</span>  <span class="number">0</span> <span class="number">10</span>:<span class="number">47</span> pts/<span class="number">1</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> grep -<span class="literal">-color</span>=auto ssh</span><br></pre></td></tr></table></figure>

<ul>
<li>设置免密码登录(要用root账户登录，不然登录时候仍然要密码)<br>使用如下命令，一直回车，直到生成了rsa</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh<span class="literal">-keygen</span> <span class="literal">-t</span> rsa</span><br><span class="line"><span class="comment">#会输出如下信息</span></span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.</span><br></pre></td></tr></table></figure>
<p>导入authorized_keys</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>
<p>测试是否免密码登录localhost</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh localhost</span><br></pre></td></tr></table></figure>

<ul>
<li>关闭防火墙</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ufw disable</span><br></pre></td></tr></table></figure>
<h2 id="安装Hadoop单击模式和伪分布模式"><a href="#安装Hadoop单击模式和伪分布模式" class="headerlink" title="安装Hadoop单击模式和伪分布模式"></a>安装Hadoop单击模式和伪分布模式</h2><ul>
<li>下载并解压hadoop-2.7.4.tar.gz</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget hhttp://archive.apache.org/dist/hadoop/common/hadoop<span class="literal">-2</span>.<span class="number">7.4</span>/hadoop<span class="literal">-2</span>.<span class="number">7.4</span>.tar.gz</span><br><span class="line">sudo tar zxvf hadoop<span class="literal">-2</span>.<span class="number">7.4</span>.tar.gz <span class="literal">-C</span> /usr/local</span><br></pre></td></tr></table></figure>

<ul>
<li>切换到/usr/local下，将hadoop-2.7.4重命名为hadoop，并给/usr/local/hadoop设置访问权限。（<strong>-R为递归的给目录权限，必须！</strong>）</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local</span><br><span class="line">sudo mv hadoop<span class="literal">-2</span>.<span class="number">7.4</span> hadoop </span><br><span class="line">sudo chmod <span class="number">777</span> <span class="literal">-R</span> /usr/local/hadoop</span><br></pre></td></tr></table></figure>

<ul>
<li>配置.bashsc文件</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br><span class="line"><span class="comment">#在文件末尾追加下面内容，然后保存。（注意路径）</span></span><br><span class="line"><span class="comment">#HADOOP VARIABLES START </span></span><br><span class="line">export HADOOP_HOME=/usr/local/hadoop</span><br><span class="line">export HADOOP_INSTALL=<span class="variable">$HADOOP_HOME</span></span><br><span class="line">export HADOOP_MAPRED_HOME=<span class="variable">$HADOOP_HOME</span></span><br><span class="line">export HADOOP_COMMON_HOME=<span class="variable">$HADOOP_HOME</span></span><br><span class="line">export HADOOP_HDFS_HOME=<span class="variable">$HADOOP_HOME</span></span><br><span class="line">export YARN_HOME=<span class="variable">$HADOOP_HOME</span></span><br><span class="line">export HADOOP_COMMON_LIB_NATIVE_DIR=<span class="variable">$HADOOP_HOME</span>/lib/native</span><br><span class="line">export PATH=<span class="variable">$PATH:</span><span class="variable">$HADOOP_HOME</span>/sbin:<span class="variable">$HADOOP_HOME</span>/bin</span><br><span class="line">export HADOOP_CONF_DIR=<span class="variable">$HADOOP_HOME</span></span><br><span class="line">export HADOOP_PREFIX=<span class="variable">$HADOOP_HOME</span></span><br><span class="line">export HADOOP_LIBEXEC_DIR=<span class="variable">$HADOOP_HOME</span>/libexec</span><br><span class="line">export JAVA_LIBRARY_PATH=<span class="variable">$HADOOP_HOME</span>/lib/native:<span class="variable">$JAVA_LIBRARY_PATH</span></span><br><span class="line">export HADOOP_CONF_DIR=<span class="variable">$HADOOP_PREFIX</span>/etc/hadoop</span><br><span class="line"><span class="comment">#HADOOP VARIABLES END</span></span><br></pre></td></tr></table></figure>
<ul>
<li>执行下面命令，使添加的环境变量生效</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>

<ul>
<li>Hadoop配置（伪分布式搭建）<br>配置hadoop-env.sh</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /usr/local/hadoop/etc/hadoop/hadoop<span class="literal">-env</span>.sh</span><br><span class="line"><span class="comment">#在末尾添加如下内容：(注意jdk文件名)</span></span><br><span class="line"><span class="comment"># The java implementation to use. </span></span><br><span class="line">export JAVA_HOME=/usr/java/jdk<span class="literal">-13</span>.<span class="number">0.1</span></span><br><span class="line">export HADOOP=/usr/local/hadoop</span><br><span class="line">export PATH=<span class="variable">$PATH:</span>/usr/local/hadoop/bin</span><br></pre></td></tr></table></figure>
<p>配置yarn-env.sh</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /usr/local/hadoop/etc/hadoop/yarn<span class="literal">-env</span>.sh</span><br><span class="line">在末尾添加如下内容：(注意jdk文件名)</span><br><span class="line"><span class="comment"># export JAVA_HOME=/usr/java/jdk-13.0.1</span></span><br><span class="line">JAVA_HOME=/usr/java/jdk<span class="literal">-13</span>.<span class="number">0.1</span></span><br></pre></td></tr></table></figure>
<p>配置core-site.xml，（这里的tmp.dir不用改，是缓存目录）</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">vim</span> <span class="string">/usr/local/hadoop/etc/hadoop/core-site.xml</span></span><br><span class="line"><span class="comment">#插入如下内容</span></span><br><span class="line"><span class="comment">#注意：将core-site.xml中原来的有的&lt;configuration&gt; &lt; /configuration &gt;一定要删除掉，不然后面格式化的时候会出错。即.xml文件中只有一个&lt;configuration&gt; &lt; /configuration &gt;对就可以。</span></span><br><span class="line"><span class="string">&lt;configuration&gt;</span></span><br><span class="line">        <span class="string">&lt;property&gt;</span></span><br><span class="line">             <span class="string">&lt;name&gt;hadoop.tmp.dir&lt;/name&gt;</span></span><br><span class="line">             <span class="string">&lt;value&gt;file:/usr/local/hadoop/tmp&lt;/value&gt;</span></span><br><span class="line">             <span class="string">&lt;description&gt;Abase</span> <span class="string">for</span> <span class="string">other</span> <span class="string">temporary</span> <span class="string">directories.&lt;/description&gt;</span></span><br><span class="line">        <span class="string">&lt;/property&gt;</span></span><br><span class="line">        <span class="string">&lt;property&gt;</span></span><br><span class="line">             <span class="string">&lt;name&gt;fs.defaultFS&lt;/name&gt;</span></span><br><span class="line">             <span class="string">&lt;value&gt;hdfs://localhost:9000&lt;/value&gt;</span></span><br><span class="line">        <span class="string">&lt;/property&gt;</span></span><br><span class="line"><span class="string">&lt;/configuration&gt;</span></span><br></pre></td></tr></table></figure>
<p>同样修改配置文件 hdfs-site.xml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">vim</span> <span class="string">/usr/local/hadoop/etc/hadoop/hdfs-site.xml</span></span><br><span class="line"><span class="comment">#插入下列内容：（删除原有的&lt;configuration&gt;）</span></span><br><span class="line"><span class="string">&lt;configuration&gt;</span></span><br><span class="line">        <span class="string">&lt;property&gt;</span></span><br><span class="line">             <span class="string">&lt;name&gt;dfs.replication&lt;/name&gt;</span></span><br><span class="line">             <span class="string">&lt;value&gt;1&lt;/value&gt;</span></span><br><span class="line">        <span class="string">&lt;/property&gt;</span></span><br><span class="line">        <span class="string">&lt;property&gt;</span></span><br><span class="line">             <span class="string">&lt;name&gt;dfs.namenode.name.dir&lt;/name&gt;</span></span><br><span class="line">             <span class="string">&lt;value&gt;file:/usr/local/hadoop/tmp/dfs/name&lt;/value&gt;</span></span><br><span class="line">        <span class="string">&lt;/property&gt;</span></span><br><span class="line">        <span class="string">&lt;property&gt;</span></span><br><span class="line">             <span class="string">&lt;name&gt;dfs.datanode.data.dir&lt;/name&gt;</span></span><br><span class="line">             <span class="string">&lt;value&gt;file:/usr/local/hadoop/tmp/dfs/data&lt;/value&gt;</span></span><br><span class="line">        <span class="string">&lt;/property&gt;</span></span><br><span class="line"><span class="string">&lt;/configuration&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Hadoop配置文件说明</strong><br><em>Hadoop 的运行方式是由配置文件决定的（运行 Hadoop 时会读取配置文件），因此如果需要从伪分布式模式切换回非分布式模式，需要删除 core-site.xml 中的配置项。此外，伪分布式虽然只需要配置 fs.defaultFS 和 dfs.replication 就可以运行，不过若没有配置 hadoop.tmp.dir 参数，则默认使用的临时目录为 /tmp/hadoo-hadoop，而这个目录在重启时有可能被系统清理掉，导致必须重新执行 format 才行。同时也指定 dfs.namenode.name.dir 和 dfs.datanode.data.dir，否则在接下来的步骤中可能会出错。</em></li>
</ul>
<p>配置yarn-site.xml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">vim</span> <span class="string">/usr/local/hadoop/etc/hadoop/yarn-site.xml</span> </span><br><span class="line"><span class="comment">#插入下列内容</span></span><br><span class="line"><span class="string">&lt;configuration&gt;</span> </span><br><span class="line"><span class="string">&lt;!--</span> <span class="string">Site</span> <span class="string">specific</span> <span class="string">YARN</span> <span class="string">configuration</span> <span class="string">properties</span> <span class="string">--&gt;</span></span><br><span class="line">    <span class="string">&lt;property&gt;</span> </span><br><span class="line">        <span class="string">&lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;</span> </span><br><span class="line">        <span class="string">&lt;value&gt;mapreduce_shuffle&lt;/value&gt;</span> </span><br><span class="line">    <span class="string">&lt;/property&gt;</span> </span><br><span class="line">    <span class="string">&lt;property&gt;</span> </span><br><span class="line">        <span class="string">&lt;name&gt;yarn.nodemanager.aux-services.mapreduce.shuffle.class&lt;/name&gt;</span> </span><br><span class="line">        <span class="string">&lt;value&gt;org.apache.hadoop.mapred.ShuffleHandler&lt;/value&gt;</span> </span><br><span class="line">    <span class="string">&lt;/property&gt;</span> </span><br><span class="line">    <span class="string">&lt;property&gt;</span> </span><br><span class="line">        <span class="string">&lt;name&gt;yarn.resourcemanager.address&lt;/name&gt;</span> </span><br><span class="line">        <span class="string">&lt;value&gt;127.0.0.1:8032&lt;/value&gt;</span> </span><br><span class="line">    <span class="string">&lt;/property&gt;</span> </span><br><span class="line">    <span class="string">&lt;property&gt;</span> </span><br><span class="line">        <span class="string">&lt;name&gt;yarn.resourcemanager.scheduler.address&lt;/name&gt;</span> </span><br><span class="line">        <span class="string">&lt;value&gt;127.0.0.1:8030&lt;/value&gt;</span> </span><br><span class="line">    <span class="string">&lt;/property&gt;</span> </span><br><span class="line">    <span class="string">&lt;property&gt;</span> </span><br><span class="line">        <span class="string">&lt;name&gt;yarn.resourcemanager.resource-tracker.address&lt;/name&gt;</span> </span><br><span class="line">        <span class="string">&lt;value&gt;127.0.0.1:8031&lt;/value&gt;</span> </span><br><span class="line">    <span class="string">&lt;/property&gt;</span> </span><br><span class="line"><span class="string">&lt;/configuration&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>关机重启系统<br><strong>note： 以上三个文件都必须删除原来的<configuration>对，在复制进去，否则会在后面格式化时发生如下错误 ！！！！！</strong><br><img src="https://img-blog.csdnimg.cn/20191224134023290.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><h2 id="验证hadoop是否安装并配置成功"><a href="#验证hadoop是否安装并配置成功" class="headerlink" title="验证hadoop是否安装并配置成功"></a>验证hadoop是否安装并配置成功</h2></li>
<li>验证Hadoop单击模式</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hadoop version</span><br><span class="line"><span class="comment">#若输出如下内容说明配置成功</span></span><br><span class="line">Hadoop <span class="number">2.7</span>.<span class="number">4</span></span><br><span class="line">Subversion https://shv@git<span class="literal">-wip</span><span class="literal">-us</span>.apache.org/repos/asf/hadoop.git <span class="literal">-r</span> cd915e1e8d9d0131462a0b7301586c175728a282</span><br><span class="line">Compiled by kshvachk on <span class="number">2017</span><span class="literal">-08</span><span class="literal">-01T00</span>:<span class="number">29</span>Z</span><br><span class="line">Compiled with protoc <span class="number">2.5</span>.<span class="number">0</span></span><br><span class="line">From source with checksum <span class="number">50</span>b0468318b4ce9bd24dc467b7ce1148</span><br><span class="line">This command was run <span class="keyword">using</span> /usr/local/hadoop/share/hadoop/common/hadoop-common-2.7.4.jar</span><br></pre></td></tr></table></figure>

<ul>
<li>启动HDFS为分布式模式<br>格式化namenode</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hdfs namenode <span class="literal">-format</span></span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line">...</span><br><span class="line"><span class="number">19</span>/<span class="number">12</span>/<span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">41</span> INFO namenode.FSImage: Allocated new BlockPoolId: BP<span class="literal">-1645567278</span><span class="literal">-127</span>.<span class="number">0.1</span>.<span class="number">1</span><span class="literal">-1577168801272</span></span><br><span class="line"><span class="number">19</span>/<span class="number">12</span>/<span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">41</span> INFO common.Storage: Storage directory /usr/local/hadoop/tmp/dfs/name has been successfully formatted.</span><br><span class="line"><span class="number">19</span>/<span class="number">12</span>/<span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">41</span> INFO namenode.FSImageFormatProtobuf: Saving image file /usr/local/hadoop/tmp/dfs/name/current/fsimage.ckpt_0000000000000000000 <span class="keyword">using</span> no compression</span><br><span class="line"><span class="number">19</span>/<span class="number">12</span>/<span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">41</span> INFO namenode.FSImageFormatProtobuf: Image file /usr/local/hadoop/tmp/dfs/name/current/fsimage.ckpt_0000000000000000000 of size <span class="number">321</span> bytes saved <span class="keyword">in</span> <span class="number">0</span> seconds.</span><br><span class="line"><span class="number">19</span>/<span class="number">12</span>/<span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">41</span> INFO namenode.NNStorageRetentionManager: Going to retain <span class="number">1</span> images with txid &gt;= <span class="number">0</span></span><br><span class="line"><span class="number">19</span>/<span class="number">12</span>/<span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">41</span> INFO util.ExitUtil: Exiting with status <span class="number">0</span></span><br><span class="line"><span class="number">19</span>/<span class="number">12</span>/<span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">41</span> INFO namenode.NameNode: SHUTDOWN_MSG: </span><br><span class="line">/************************************************************</span><br><span class="line">SHUTDOWN_MSG: Shutting down NameNode at gbh/<span class="number">127.0</span>.<span class="number">1.1</span></span><br><span class="line">************************************************************/</span><br></pre></td></tr></table></figure>

<p><strong>note:有successfully formatted代表格式化成功。Existing with 1代表有错误。</strong></p>
<p>启动hdfs</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">start-all</span>.sh</span><br></pre></td></tr></table></figure>
<p>显示进程</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">jps </span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line">root@gbh:/usr/local/hadoop<span class="comment"># jps </span></span><br><span class="line"><span class="number">5568</span> ResourceManager</span><br><span class="line"><span class="number">5170</span> DataNode</span><br><span class="line"><span class="number">6019</span> Jps</span><br><span class="line"><span class="number">5399</span> SecondaryNameNode</span><br><span class="line"><span class="number">4985</span> NameNode</span><br><span class="line"><span class="number">5727</span> NodeManager</span><br></pre></td></tr></table></figure>
<p><strong>note：有7个进程代表正确</strong><br>在浏览器中输入<a href="http://localhost:50070/，出现如下页面" target="_blank" rel="noopener">http://localhost:50070/，出现如下页面</a></p>
<p><img src="https://img-blog.csdnimg.cn/20191224144355260.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">输入 <a href="http://localhost:8088/，" target="_blank" rel="noopener">http://localhost:8088/，</a> 出现如下页面<br><img src="https://img-blog.csdnimg.cn/20191224144727293.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="Hadop实例：词频统计"><a href="#Hadop实例：词频统计" class="headerlink" title="Hadop实例：词频统计"></a>Hadop实例：词频统计</h2><ul>
<li>启动HDFS</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">start-all</span>.sh</span><br></pre></td></tr></table></figure>
<p>查看HDFS下面包含的文件目录</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hadoop dfs <span class="literal">-ls</span> /</span><br><span class="line"><span class="comment">#第一次运行hdfs什么都没有</span></span><br><span class="line">DEPRECATED: Use of this script to execute hdfs command is deprecated.</span><br><span class="line">Instead use the hdfs command <span class="keyword">for</span> it.</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>在HDFS中创建一个文件目录input，将/usr/local/hadoop/README.txt上传至input中，此时再用ls查看就发现多了个input目录</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs <span class="literal">-mkdir</span> /input</span><br><span class="line">hadoop fs <span class="literal">-put</span> /usr/local/hadoop/README.txt /input</span><br><span class="line">hadoop dfs <span class="literal">-ls</span> /input</span><br><span class="line"><span class="comment">#output</span></span><br><span class="line">Found <span class="number">1</span> items</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--   <span class="number">1</span> root supergroup       <span class="number">1366</span> <span class="number">2019</span><span class="literal">-12</span><span class="literal">-24</span> <span class="number">14</span>:<span class="number">52</span> /input/README.txt</span><br></pre></td></tr></table></figure>
<p> 执行一下命令运行wordcount 并将结果输出到output中</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">hadoop jar /usr/local/hadoop/share/hadoop/mapreduce/hadoop<span class="literal">-mapreduce</span><span class="literal">-examples</span><span class="literal">-2</span>.<span class="number">7.4</span>.jar wordcount /input /output</span><br><span class="line"><span class="comment">#输出如下</span></span><br><span class="line">...</span><br><span class="line"><span class="number">19</span>/<span class="number">12</span>/<span class="number">24</span> <span class="number">14</span>:<span class="number">55</span>:<span class="number">25</span> INFO mapreduce.Job:  map <span class="number">100</span>% reduce <span class="number">100</span>%</span><br><span class="line"><span class="number">19</span>/<span class="number">12</span>/<span class="number">24</span> <span class="number">14</span>:<span class="number">55</span>:<span class="number">25</span> INFO mapreduce.Job: Job job_local609248869_0001 completed successfully</span><br><span class="line"><span class="number">19</span>/<span class="number">12</span>/<span class="number">24</span> <span class="number">14</span>:<span class="number">55</span>:<span class="number">25</span> INFO mapreduce.Job: Counters: <span class="number">35</span></span><br><span class="line">	File System Counters</span><br><span class="line">		FILE: Number of bytes read=<span class="number">599278</span></span><br><span class="line">		FILE: Number of bytes written=<span class="number">1185318</span></span><br><span class="line">		FILE: Number of read operations=<span class="number">0</span></span><br><span class="line">		FILE: Number of large read operations=<span class="number">0</span></span><br><span class="line">		FILE: Number of write operations=<span class="number">0</span></span><br><span class="line">		HDFS: Number of bytes read=<span class="number">2732</span></span><br><span class="line">		HDFS: Number of bytes written=<span class="number">1306</span></span><br><span class="line">		HDFS: Number of read operations=<span class="number">13</span></span><br><span class="line">		HDFS: Number of large read operations=<span class="number">0</span></span><br><span class="line">		HDFS: Number of write operations=<span class="number">4</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>有以上输出，说明统计成功。<br>执行成功后output 目录底下会生成两个文件 _SUCCESS 成功标志的文件，里面没有内容。 一个是 part-r-00000 ，通过以下命令查看执行的结果。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs <span class="literal">-cat</span> /output/part<span class="literal">-r</span><span class="literal">-00000</span></span><br><span class="line"><span class="comment">#下面是统计的词频结果</span></span><br><span class="line">(BIS),	<span class="number">1</span></span><br><span class="line">(ECCN)	<span class="number">1</span></span><br><span class="line">(TSU)	<span class="number">1</span></span><br><span class="line">(see	<span class="number">1</span></span><br><span class="line"><span class="number">5</span>D002.C.<span class="number">1</span>,	<span class="number">1</span></span><br><span class="line"><span class="number">740.13</span>)	<span class="number">1</span></span><br><span class="line">&lt;http://www.wassenaar.org/&gt;	<span class="number">1</span></span><br><span class="line">Administration	<span class="number">1</span></span><br><span class="line">Apache	<span class="number">1</span></span><br><span class="line">BEFORE	<span class="number">1</span></span><br><span class="line">BIS	<span class="number">1</span></span><br><span class="line">Bureau	<span class="number">1</span></span><br><span class="line">Commerce,	<span class="number">1</span></span><br><span class="line">Commodity	<span class="number">1</span></span><br><span class="line">Control	<span class="number">1</span></span><br><span class="line">Core	<span class="number">1</span></span><br><span class="line">Department	<span class="number">1</span></span><br><span class="line">ENC	<span class="number">1</span></span><br><span class="line">Exception	<span class="number">1</span></span><br><span class="line">Export	<span class="number">2</span></span><br><span class="line"><span class="keyword">For</span>	<span class="number">1</span></span><br><span class="line">Foundation	<span class="number">1</span></span><br><span class="line">Government	<span class="number">1</span></span><br><span class="line">Hadoop	<span class="number">1</span></span><br><span class="line">Hadoop,	<span class="number">1</span></span><br><span class="line">Industry	<span class="number">1</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="下面附一些HDFS常用命令"><a href="#下面附一些HDFS常用命令" class="headerlink" title="下面附一些HDFS常用命令"></a>下面附一些HDFS常用命令</h2><ul>
<li>hadoop fs -mkdir /tmp/input       在HDFS上新建文件夹 </li>
<li>hadoop fs -put input1.txt /tmp/input 把本地文件input1.txt传到HDFS的/tmp/input目录下 </li>
<li>hadoop fs -get input1.txt /tmp/input/input1.txt 把HDFS文件拉到本地 </li>
<li>hadoop fs -ls /tmp/output         列出HDFS的某目录 </li>
<li>hadoop fs -cat /tmp/ouput/output1.txt 查看HDFS上的文件 </li>
<li>hadoop fs -rmr /home/less/hadoop/tmp/output 删除HDFS上的目录 </li>
<li>hadoop dfsadmin -report 查看HDFS状态，比如有哪些datanode，每个datanode的情况 </li>
<li>hadoop dfsadmin -safemode leave 离开安全模式 </li>
<li>hadoop dfsadmin -safemode enter 进入安全模式</li>
</ul>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/24/Ubuntu18-04%E4%B8%8B%E5%AE%89%E8%A3%85Hadoop%E5%8D%95%E6%9C%BA%E4%B8%8E%E4%BC%AA%E5%88%86%E5%B8%83%E5%BC%8F%E7%8E%AF%E5%A2%83/" data-id="ck4jj08ev000048vi2a10ef10"
        class="article-share-link">分享</a>
      
    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-基于ModelArts的目标检测——找云宝" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/20/%E5%9F%BA%E4%BA%8EModelArts%E7%9A%84%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E2%80%94%E2%80%94%E6%89%BE%E4%BA%91%E5%AE%9D/"
    >基于ModelArts的目标检测——找云宝</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/12/20/%E5%9F%BA%E4%BA%8EModelArts%E7%9A%84%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E2%80%94%E2%80%94%E6%89%BE%E4%BA%91%E5%AE%9D/" class="article-date">
  <time datetime="2019-12-20T05:09:30.000Z" itemprop="datePublished">2019-12-20</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <ol>
<li><p>步骤1：准备数据</p>
</li>
<li><p>步骤2：创建物体检测项目</p>
</li>
<li><p>步骤3：数据标注</p>
</li>
<li><p>步骤4：自动训练，生成模型</p>
</li>
<li><p>步骤5：将模型部署上线为在线服务</p>
</li>
<li><p>步骤6：测试服务</p>
<h2 id="步骤1：准备数据"><a href="#步骤1：准备数据" class="headerlink" title="步骤1：准备数据"></a>步骤1：准备数据</h2><p>ModelArts在公共OBS桶中提供了云宝的示例数据集，命名为“Yunbao-Data-Custom“，因此，本文的操作示例使用此数据集进行模型构建。首先将<a href="https://modelarts-cnnorth1-market-dataset.obs.cn-north-1.myhuaweicloud.com/dataset-market/Yunbao-Data-Custom/archiver/Yunbao-Data-Custom.zip" target="_blank" rel="noopener">数据集</a>下载到本地；在本地，将“Yunbao-Data-Custom.zip“压缩包解压。例如，解压至本地“Yunbao-Data-Custom“文件夹下。使用批量上传方式将“Yunbao-Data-Custom“文件夹下的所有文件上传至OBS路径下。例如“/yunbao-ai/dataset-yunbao-ai”。获取的数据集分为2个子目录，分别为“eval“和“train“。“train“存储的数据用于模型训练，“eval“存储的数据可用于模型的预测。</p>
<h2 id="步骤2：创建物体检测项目"><a href="#步骤2：创建物体检测项目" class="headerlink" title="步骤2：创建物体检测项目"></a>步骤2：创建物体检测项目</h2><ol>
<li>在ModelArts管理控制台，单击左侧导航栏[“自动学习”]。(<a href="https://console.huaweicloud.com/modelarts/?region=cn-north-4#/manage/dashboard" target="_blank" rel="noopener">https://console.huaweicloud.com/modelarts/?region=cn-north-4#/manage/dashboard</a>)</li>
<li>在“物体检测“方框中单击“创建项目“，在“创建物体检测项目“页面中，填写“项目名称“，选择训练数据，云宝数据集OBS路径为”/yunbao-ai/dataset-yunbao-ai/train/“。</li>
<li>单击“创建项目“，完成物体检测项目创建。项目创建成功后，页面自动跳转至“自动学习“页面，并自动执行数据源同步操作。创建完成后如图1所示。<br><img src="https://img-blog.csdnimg.cn/20191220111036251.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_16,color_FFFFFF,t_70" alt="图1"> </li>
</ol>
<h2 id="步骤3：标注数据"><a href="#步骤3：标注数据" class="headerlink" title="步骤3：标注数据"></a>步骤3：标注数据</h2><p>数据标注，针对物体检测项目，即在已有数据集图像中，标注出物体位置，并为其打上标签。标注好的数据用于模型训练。</p>
<ol>
<li>在自动学习页面，单击项目名称，进入自动学习模型构建的主页面。自动学习项目创建时，会自动执行数据源同步操作。由于数据源同步需要一定时间，如果出现同步失败，可单击“同步数据源“手动执行。</li>
<li>在“数据标注“页面单击“未标注“页签，此页面展示所有未标注的图片数据。单击任意一张图片，进入图片标注界面。</li>
<li>用鼠标框选图片中的云宝所在区域，然后在弹出的对话框中输入标签名称，例如此示例中的“yunbao“，按“Enter“键完成此图片的添加。标注完成后，左侧图片目录中此图片的状态将显示为“已标注“。<br><img src="https://img-blog.csdnimg.cn/20191220112333977.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_16,color_FFFFFF,t_70" alt="biaozhu"> </li>
</ol>
<h2 id="步骤4：自动训练，生成模型"><a href="#步骤4：自动训练，生成模型" class="headerlink" title="步骤4：自动训练，生成模型"></a>步骤4：自动训练，生成模型</h2><ol>
<li>完成数据标注后，在“数据标注“页面设置训练参数，首次训练建议训练时长不要超过1小时，后面可以根据训练精度调整训练时长。也可单击“高级设置“，对推理时间和训练版本进行设置。<br><img src="https://img-blog.csdnimg.cn/20191220124026446.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_16,color_FFFFFF,t_70" alt="train"></li>
<li>单击“开始训练“，开始模型的自动训练。训练时间相对较长。如果关闭或退出此页面，系统仍然在执行训练操作。<br><img src="https://img-blog.csdnimg.cn/20191220124303464.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_16,color_FFFFFF,t_70" alt="training">  </li>
</ol>
<h2 id="步骤5：将模型部署上线为在线服务"><a href="#步骤5：将模型部署上线为在线服务" class="headerlink" title="步骤5：将模型部署上线为在线服务"></a>步骤5：将模型部署上线为在线服务</h2><ol>
<li>在“模型训练“页签中，待训练状态变为“运行成功“，单击“版本管理“区域中的“部署“，开始将物体检测模型部署上线至在线服务。<br><img src="https://img-blog.csdnimg.cn/20191220125153997.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_16,color_FFFFFF,t_70" alt="deploy"></li>
<li>启动部署上线后，系统自动跳转至部署上线页面。此页面将呈现模型部署上线的进度和状态。部署上线将耗费较多时间，请耐心等待。部署完成后，版本管理区域的状态将变更为“部署成功”。<br><img src="https://img-blog.csdnimg.cn/20191220125358755.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_16,color_FFFFFF,t_70" alt="部署">  </li>
</ol>
<h2 id="步骤6：测试服务"><a href="#步骤6：测试服务" class="headerlink" title="步骤6：测试服务"></a>步骤6：测试服务</h2><ol>
<li>在“部署上线“界面，选择状态为“部署成功“的服务版本，在“服务测试“区域单击“上传”。<br><img src="https://img-blog.csdnimg.cn/20191220130145234.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_16,color_FFFFFF,t_70" alt="test"></li>
<li>从本地环境选择一张图片，此图片中包含云宝。然后单击“预测“进行测试。<br>预测完成后，右侧“预测结果“区域输出标签名称“yunbao“，以及位置坐标和检测的评分。预测结果中，“detection_boxes“表示物体所在位置坐标，“detection_scores“表示检测评分，表示坐标内图像是云宝的概览评分。<br><img src="https://img-blog.csdnimg.cn/20191220130437345.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2diaDE4NjgyMDMwODYy,size_16,color_FFFFFF,t_70" alt="预测">可以看到三个云宝图片预测结果分别是100%、98%和85%，准确率还是很高的。</li>
</ol>
</li>
</ol>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/20/%E5%9F%BA%E4%BA%8EModelArts%E7%9A%84%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E2%80%94%E2%80%94%E6%89%BE%E4%BA%91%E5%AE%9D/" data-id="ck4dr7dck0001x0viccx6dxyq"
        class="article-share-link">分享</a>
      
    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-hello-world" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/19/hello-world/"
    >Hello World</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/12/19/hello-world/" class="article-date">
  <time datetime="2019-12-19T11:26:36.086Z" itemprop="datePublished">2019-12-19</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/19/hello-world/" data-id="ck4dr7dc90000x0vi33aq1269"
        class="article-share-link">分享</a>
      
    </footer>

  </div>

  

  
  
  

  

</article>
    
  </article>
  

  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2015-2020
        Bihui
      </li>
      <li>
        
      </li>
    </ul>
    <ul class="list-inline">
      <li>
        
        
        <ul class="list-inline">
  <li>PV:<span id="busuanzi_value_page_pv"></span></li>
  <li>UV:<span id="busuanzi_value_site_uv"></span></li>
</ul>
        
      </li>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>
    <div class="to_top">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>
      </div>
    </main>
    
      <aside class="sidebar">
        
        <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="面朝大海，春暖花开"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">目录</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags/%E6%97%85%E8%A1%8C/">旅行</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/null">摄影</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/null">阅读</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2019/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
      </aside>
      <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i></p>
  <div class="reward-box">
    
    
  </div>
</div>
      
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>





<script>
  var ayerConfig = {
    mathjax: false
  }
</script>


<script src="/js/ayer.js"></script>


<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">



<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>
  
  
  </div>
</body>

</html>